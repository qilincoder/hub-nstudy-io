import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as n,c as a,e as t}from"./app-DKHkdyNf.js";const o={},s=t(`<h2 id="机器环境" tabindex="-1"><a class="header-anchor" href="#机器环境"><span>机器环境</span></a></h2><blockquote><p>本实践将在 Ubuntu 22.04.3LTS 系统上进行安装测试<br> docker 版本<code>Docker Engine - Community 24.0.6</code> ，原则上docker版本无影响</p></blockquote><h2 id="背景" tabindex="-1"><a class="header-anchor" href="#背景"><span>背景</span></a></h2><blockquote><p>因项目需求,需要再docker容器里面添加额外的hosts文件内容,想在通过 -v 挂载hosts文件,但是发现docker容器里面无法加载外部的hosts文件</p></blockquote><h2 id="操作过程记录" tabindex="-1"><a class="header-anchor" href="#操作过程记录"><span>操作过程记录</span></a></h2><ul><li>运行容器脚本</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8088</span>:80 <span class="token parameter variable">-p</span> <span class="token number">8081</span>:8081 
  <span class="token parameter variable">-v</span> /root/deploy/nginx/hosts:/ect/hosts 
  <span class="token parameter variable">-v</span> /root/deploy/nginx/nginx.conf:/etc/nginx/nginx.conf 
  <span class="token parameter variable">-v</span> /root/deploy/nginx/default.conf:/etc/nginx/conf.d/default.conf 
  <span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token parameter variable">--name</span> nginx-example nginx:1.23.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>现象1:上 面 <code>/ect/hosts</code> 无法被外面覆盖 , 当前docker机制为自动生成和维护</li></ul><blockquote><p><code>/var/lib/docker/containers/208b5870ad6889327a29e4ced312a66c377c885188303706a682793f72425125/hosts</code> 文件为容器内的hosts文件的物理位置<br> 通过 <code>docker inspect nginx-example</code> 获取到</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">vim</span> /var/lib/docker/containers/208b5870ad6889327a29e4ced312a66c377c885188303706a682793f72425125/hosts

<span class="token comment"># 修改也无效，且重启后 </span>

<span class="token function">cat</span> /var/lib/docker/containers/208b5870ad6889327a29e4ced312a66c377c885188303706a682793f72425125/hosts

<span class="token comment"># 重新变回容器文件</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>现象2:</li></ul><blockquote><p><code>etc/nginx/nginx.conf</code> <code>/etc/nginx/conf.d/default.conf</code> 两个文件， 在宿主机更改，不重启容器容器无法感知到，重启后可以感知到</p></blockquote><ul><li>现象3:</li></ul><blockquote><p>在容器里面更改上述两个文件，宿主机可以感知到</p></blockquote><ul><li>现象4:家目录，如 home、xx , 现象同3</li></ul><h2 id="分析" tabindex="-1"><a class="header-anchor" href="#分析"><span>分析</span></a></h2><blockquote><p>现象3，现象4 这是由于linux系统文件挂载机制导致的。可以通过挂在目录的形式来实现<br> docker挂载文件时，并不是挂载了某个文件的路径，而是挂载了对应的文件，即挂载了linux指定的 <span style="color:red;">inode</span> 文件。<br> 当使用vim之类的编辑器进行保存时，它不是直接保存文件，而是采用了<span style="color:red;">备份、替换</span>的策略，就是编辑时，是创建一个新的文件，在保存的时候，把备份文件替换源文件，这个时候文件的 <span style="color:red;">inode </span>就发生了变化，而原来<span style="color:red;"> inode</span> 对应的文件其实并没有修改，也就是容器内的文件没有变化。当重启容器的时候，会挂载新的 <span style="color:red;">inode</span> 文件，所以容器内的文件没有变化。</p></blockquote><h2 id="此路不同-就像其他路径" tabindex="-1"><a class="header-anchor" href="#此路不同-就像其他路径"><span>此路不同,就像其他路径</span></a></h2><blockquote><p>脚本修改完配置文件后，重启容器 <code>docker restart nginx-example</code></p></blockquote>`,19),c=[s];function r(l,i){return n(),a("div",null,c)}const u=e(o,[["render",r],["__file","592d48.html.vue"]]),m=JSON.parse(`{"path":"/p2024/Docker/592d48.html","title":"dockerHosts文件无法外面加载","lang":"zh-CN","frontmatter":{"permalink":"/p2024/Docker/592d48.html","lang":"zh-CN","title":"dockerHosts文件无法外面加载","description":"dockerHosts文件无法外面加载","isOriginal":true,"date":"2024-03-31T00:00:00.000Z","category":["docker","Hosts"],"tag":["docker","Hosts"],"head":[["meta",{"name":"keywords","content":"dockerHosts文件无法外面加载,docker,Hosts"}],["meta",{"property":"og:url","content":"https://hub.nstudy.org/p2024/Docker/592d48.html"}],["meta",{"property":"og:site_name","content":"Jack's 新学习基地"}],["meta",{"property":"og:title","content":"dockerHosts文件无法外面加载"}],["meta",{"property":"og:description","content":"dockerHosts文件无法外面加载"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-08T03:28:49.000Z"}],["meta",{"property":"article:author","content":"Jack"}],["meta",{"property":"article:tag","content":"docker"}],["meta",{"property":"article:tag","content":"Hosts"}],["meta",{"property":"article:published_time","content":"2024-03-31T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-04-08T03:28:49.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"dockerHosts文件无法外面加载\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-03-31T00:00:00.000Z\\",\\"dateModified\\":\\"2024-04-08T03:28:49.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Jack\\",\\"url\\":\\"https://hub.nstudy.org\\"}]}"]],"star":true,"sticky":true},"headers":[{"level":2,"title":"机器环境","slug":"机器环境","link":"#机器环境","children":[]},{"level":2,"title":"背景","slug":"背景","link":"#背景","children":[]},{"level":2,"title":"操作过程记录","slug":"操作过程记录","link":"#操作过程记录","children":[]},{"level":2,"title":"分析","slug":"分析","link":"#分析","children":[]},{"level":2,"title":"此路不同,就像其他路径","slug":"此路不同-就像其他路径","link":"#此路不同-就像其他路径","children":[]}],"git":{"createdTime":1712546929000,"updatedTime":1712546929000,"contributors":[{"name":"lizhiquan","email":"lizhiquan@jianke.com","commits":1}]},"readingTime":{"minutes":1.99,"words":596},"filePathRelative":"02.Docker/20240331_dockerHosts文件无法外面加载.md","localizedDate":"2024年3月31日","excerpt":"<h2>机器环境</h2>\\n<blockquote>\\n<p>本实践将在 Ubuntu 22.04.3LTS 系统上进行安装测试<br>\\ndocker 版本<code>Docker Engine - Community 24.0.6</code> ，原则上docker版本无影响</p>\\n</blockquote>\\n<h2>背景</h2>\\n<blockquote>\\n<p>因项目需求,需要再docker容器里面添加额外的hosts文件内容,想在通过 -v 挂载hosts文件,但是发现docker容器里面无法加载外部的hosts文件</p>\\n</blockquote>\\n<h2>操作过程记录</h2>\\n"}`);export{u as comp,m as data};
