import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as s,c as a,e}from"./app-D55Cmw5b.js";const t={},p=e(`<h1 id="本文介绍-在linux环境下nsenter调试容器命令工具的使用" tabindex="-1"><a class="header-anchor" href="#本文介绍-在linux环境下nsenter调试容器命令工具的使用"><span>本文介绍，在Linux环境下nsenter调试容器命令工具的使用</span></a></h1><h2 id="服务器说明" tabindex="-1"><a class="header-anchor" href="#服务器说明"><span>服务器说明</span></a></h2><blockquote><p>以下命令在 Ubuntu 22.04.3 LTS 系统上测试</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ubuntu@:~$ lsb_release <span class="token parameter variable">-a</span>

No LSB modules are available.
Distributor ID:	Ubuntu
Description:	Ubuntu <span class="token number">22.04</span>.3 LTS
Release:	<span class="token number">22.04</span>
Codename:	jamm
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="背景介绍" tabindex="-1"><a class="header-anchor" href="#背景介绍"><span>背景介绍</span></a></h2><blockquote><p>在容器开发过程中，发现容器中一些网络命令不可用，由于生产环境不允许联网等限制，给容器调试带来困难，因此想在宿主机调试容器，执行一些网络命令，比如 ip addr，route -n 等来发现一些问题。</p></blockquote><h2 id="nsenter介绍" tabindex="-1"><a class="header-anchor" href="#nsenter介绍"><span>nsenter介绍</span></a></h2><blockquote><p>nsenter 是一个命令行工具，用于进入指定的 Linux 命名空间。Linux 命名空间是 Linux 内核提供的一种隔离机制，允许系统中的不同进程具有独立的视图，如独立的网络栈、进程空间、挂载点等。通过进入特定的命名空间，可以在其中执行操作，而不会影响系统中的其他部分。</p></blockquote><blockquote><p>nsenter 命令允许用户进入已经存在的命名空间，以便查看或修改命名空间中的状态，或在其中执行命令。</p></blockquote><blockquote><p><em><b>The nsenter command executes program in the namespace(s) that are specified in the command-line options (described below). <span style="color:red;"> If program is not given, then &quot;\${SHELL}&quot; is run (default: /bin/sh)</span>.</b></em> <span style="color:red;">特别注意，当命名空间内命令不可用时，shell将执行 /bin/sh 的默认命令</span></p></blockquote><h2 id="实战记录" tabindex="-1"><a class="header-anchor" href="#实战记录"><span>实战记录</span></a></h2><h3 id="安装基础软件" tabindex="-1"><a class="header-anchor" href="#安装基础软件"><span>安装基础软件</span></a></h3><blockquote><p>在实践过程中，发现route命令在主机中不可以执行，因此需要安装route命令工具包</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">apt</span> update
<span class="token function">apt</span> <span class="token function">install</span> net-tools <span class="token parameter variable">-y</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="在容器内执行命令工具查看route信息" tabindex="-1"><a class="header-anchor" href="#在容器内执行命令工具查看route信息"><span>在容器内执行命令工具查看route信息</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># a8119e0f4d7c 为容器id , 也可以用容器名称代替</span>

<span class="token comment">#step 1 用容器测试</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> a8119e0f4d7c route <span class="token parameter variable">-n</span>
<span class="token comment"># print route信息</span>
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
<span class="token number">0.0</span>.0.0         <span class="token number">192.168</span>.88.1    <span class="token number">0.0</span>.0.0         UG    <span class="token number">0</span>      <span class="token number">0</span>        <span class="token number">0</span> eth0
<span class="token number">192.168</span>.88.0    <span class="token number">0.0</span>.0.0

<span class="token comment"># step 2 获取容器pid</span>
<span class="token function">docker</span> inspect <span class="token parameter variable">--format</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>.State.Pid<span class="token punctuation">}</span><span class="token punctuation">}</span> a8119e0f4d7c
<span class="token number">71553</span>

<span class="token comment"># step 3 进入容器的网络命名空间</span>
nsenter <span class="token parameter variable">-t</span> <span class="token number">71553</span> <span class="token parameter variable">-n</span>
<span class="token comment">#或</span>
nsenter <span class="token parameter variable">-n</span> <span class="token parameter variable">-t71553</span>

root@ubuntu:~<span class="token comment"># route -n</span>
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
<span class="token number">0.0</span>.0.0         <span class="token number">192.168</span>.88.1    <span class="token number">0.0</span>.0.0         UG    <span class="token number">0</span>      <span class="token number">0</span>        <span class="token number">0</span> eth0
<span class="token number">192.168</span>.88.0    <span class="token number">0.0</span>.0.0         <span class="token number">255.255</span>.255.0   U     <span class="token number">0</span>      <span class="token number">0</span>        <span class="token number">0</span> eth0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="在容器内执行命令工具查看其他信息" tabindex="-1"><a class="header-anchor" href="#在容器内执行命令工具查看其他信息"><span>在容器内执行命令工具查看其他信息</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment">#本文档是真实实践的记录，并不全是罗列命令说明性文档，重在实践，有实际的项目需要才会促进文档完善，期待下一次实际应用</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="参考信息" tabindex="-1"><a class="header-anchor" href="#参考信息"><span>参考信息</span></a></h3><h3 id="man-nsenter" tabindex="-1"><a class="header-anchor" href="#man-nsenter"><span>man nsenter</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>NSENTER<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>                                                                                  User Commands                                                                                 NSENTER<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

NAME
       nsenter - run program <span class="token keyword">in</span> different namespaces

SYNOPSIS
       nsenter <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>program <span class="token punctuation">[</span>arguments<span class="token punctuation">]</span><span class="token punctuation">]</span>

DESCRIPTION
       The nsenter <span class="token builtin class-name">command</span> executes program <span class="token keyword">in</span> the namespace<span class="token punctuation">(</span>s<span class="token punctuation">)</span> that are specified <span class="token keyword">in</span> the command-line options <span class="token punctuation">(</span>described below<span class="token punctuation">)</span>. If program is not given, <span class="token keyword">then</span> <span class="token string">&quot;<span class="token variable">\${<span class="token environment constant">SHELL</span>}</span>&quot;</span> is run <span class="token punctuation">(</span>default: /bin/sh<span class="token punctuation">)</span>.

       Enterable namespaces are:
<span class="token punctuation">..</span><span class="token punctuation">..</span>.

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查看帮助" tabindex="-1"><a class="header-anchor" href="#查看帮助"><span>查看帮助</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>nsenter <span class="token parameter variable">--help</span>

Usage:
 nsenter <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>program<span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>argument<span class="token operator">&gt;</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span>

Run a program with namespaces of other processes.

Options:
 -a, <span class="token parameter variable">--all</span>              enter all namespaces
 -t, <span class="token parameter variable">--target</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span>     target process to get namespaces from
 -m, --mount<span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>file<span class="token operator">&gt;</span><span class="token punctuation">]</span>   enter <span class="token function">mount</span> namespace
 -u, --uts<span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>file<span class="token operator">&gt;</span><span class="token punctuation">]</span>     enter UTS namespace <span class="token punctuation">(</span>hostname etc<span class="token punctuation">)</span>
 -i, --ipc<span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>file<span class="token operator">&gt;</span><span class="token punctuation">]</span>     enter System V IPC namespace
 -n, --net<span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>file<span class="token operator">&gt;</span><span class="token punctuation">]</span>     enter network namespace
 -p, --pid<span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>file<span class="token operator">&gt;</span><span class="token punctuation">]</span>     enter pid namespace
 -C, --cgroup<span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>file<span class="token operator">&gt;</span><span class="token punctuation">]</span>  enter cgroup namespace
 -U, --user<span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>file<span class="token operator">&gt;</span><span class="token punctuation">]</span>    enter user namespace
 -T, --time<span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>file<span class="token operator">&gt;</span><span class="token punctuation">]</span>    enter <span class="token function">time</span> namespace
 -S, <span class="token parameter variable">--setuid</span> <span class="token operator">&lt;</span>uid<span class="token operator">&gt;</span>     <span class="token builtin class-name">set</span> uid <span class="token keyword">in</span> entered namespace
 -G, <span class="token parameter variable">--setgid</span> <span class="token operator">&lt;</span>gid<span class="token operator">&gt;</span>     <span class="token builtin class-name">set</span> gid <span class="token keyword">in</span> entered namespace
     --preserve-credentials <span class="token keyword">do</span> not <span class="token function">touch</span> uids or gids
 -r, --root<span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>dir<span class="token operator">&gt;</span><span class="token punctuation">]</span>     <span class="token builtin class-name">set</span> the root directory
 -w, --wd<span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>dir<span class="token operator">&gt;</span><span class="token punctuation">]</span>       <span class="token builtin class-name">set</span> the working directory
 -F, --no-fork          <span class="token keyword">do</span> not fork before exec&#39;ing <span class="token operator">&lt;</span>program<span class="token operator">&gt;</span>
 -Z, --follow-context   <span class="token builtin class-name">set</span> SELinux context according to <span class="token parameter variable">--target</span> PID

 -h, <span class="token parameter variable">--help</span>             display this <span class="token builtin class-name">help</span>
 -V, <span class="token parameter variable">--version</span>          display version

For <span class="token function">more</span> details see nsenter<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,23),l=[p];function i(o,r){return s(),a("div",null,l)}const d=n(t,[["render",i],["__file","3fc139.html.vue"]]),m=JSON.parse(`{"path":"/p2024/Linux/others/3fc139.html","title":"nsenter调试容器命令工具","lang":"zh-CN","frontmatter":{"permalink":"/p2024/Linux/others/3fc139.html","lang":"zh-CN","title":"nsenter调试容器命令工具","description":"nsenter调试容器命令工具","isOriginal":true,"date":"2024-03-01T00:00:00.000Z","category":["Linux"],"tag":["Linux","nsenter","调试容器"],"head":[["meta",{"name":"keywords","content":"Linux,nsenter,调试容器"}],["meta",{"property":"og:url","content":"https://nstudy.org/p2024/Linux/others/3fc139.html"}],["meta",{"property":"og:site_name","content":"Jack's 新学习基地"}],["meta",{"property":"og:title","content":"nsenter调试容器命令工具"}],["meta",{"property":"og:description","content":"nsenter调试容器命令工具"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-07T09:07:52.000Z"}],["meta",{"property":"article:author","content":"Jack"}],["meta",{"property":"article:tag","content":"Linux"}],["meta",{"property":"article:tag","content":"nsenter"}],["meta",{"property":"article:tag","content":"调试容器"}],["meta",{"property":"article:published_time","content":"2024-03-01T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-04-07T09:07:52.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"nsenter调试容器命令工具\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-03-01T00:00:00.000Z\\",\\"dateModified\\":\\"2024-04-07T09:07:52.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Jack\\",\\"url\\":\\"https://nstudy.org\\"}]}"]],"star":true,"sticky":true},"headers":[{"level":2,"title":"服务器说明","slug":"服务器说明","link":"#服务器说明","children":[]},{"level":2,"title":"背景介绍","slug":"背景介绍","link":"#背景介绍","children":[]},{"level":2,"title":"nsenter介绍","slug":"nsenter介绍","link":"#nsenter介绍","children":[]},{"level":2,"title":"实战记录","slug":"实战记录","link":"#实战记录","children":[{"level":3,"title":"安装基础软件","slug":"安装基础软件","link":"#安装基础软件","children":[]},{"level":3,"title":"在容器内执行命令工具查看route信息","slug":"在容器内执行命令工具查看route信息","link":"#在容器内执行命令工具查看route信息","children":[]},{"level":3,"title":"在容器内执行命令工具查看其他信息","slug":"在容器内执行命令工具查看其他信息","link":"#在容器内执行命令工具查看其他信息","children":[]},{"level":3,"title":"参考信息","slug":"参考信息","link":"#参考信息","children":[]},{"level":3,"title":"man nsenter","slug":"man-nsenter","link":"#man-nsenter","children":[]},{"level":3,"title":"查看帮助","slug":"查看帮助","link":"#查看帮助","children":[]}]}],"git":{"createdTime":1712480872000,"updatedTime":1712480872000,"contributors":[{"name":"lizhiquan","email":"lizhiquan@jianke.com","commits":1}]},"readingTime":{"minutes":2.97,"words":891},"filePathRelative":"06.Linux/99.others/20240301_nsenter调试容器命令工具.md","localizedDate":"2024年3月1日","excerpt":"\\n<h2>服务器说明</h2>\\n<blockquote>\\n<p>以下命令在 Ubuntu 22.04.3 LTS 系统上测试</p>\\n</blockquote>\\n<div class=\\"language-bash\\" data-ext=\\"sh\\" data-title=\\"sh\\"><pre class=\\"language-bash\\"><code>ubuntu@:~$ lsb_release <span class=\\"token parameter variable\\">-a</span>\\n\\nNo LSB modules are available.\\nDistributor ID:\\tUbuntu\\nDescription:\\tUbuntu <span class=\\"token number\\">22.04</span>.3 LTS\\nRelease:\\t<span class=\\"token number\\">22.04</span>\\nCodename:\\tjamm\\n</code></pre></div>"}`);export{d as comp,m as data};
