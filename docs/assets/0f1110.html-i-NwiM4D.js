import{_ as o}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r,o as i,c as l,a as n,b as a,d as e,e as t}from"./app-0RuRy7YQ.js";const p={},c=t(`<h2 id="机器环境" tabindex="-1"><a class="header-anchor" href="#机器环境"><span>机器环境</span></a></h2><blockquote><p>本实践将在 Ubuntu 22.04.3LTS 系统上进行安装测试<br> docker 版本，原则上docker版本无影响</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">docker</span> version

Client: Docker Engine - Community
 Version:           <span class="token number">24.0</span>.6
 API version:       <span class="token number">1.43</span>
 Go version:        go1.20.7
 Git commit:        ed223bc
 Built:             Mon Sep  <span class="token number">4</span> <span class="token number">12</span>:31:44 <span class="token number">2023</span>
 OS/Arch:           linux/amd64
 Context:           default

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="安装portainer操作脚本" tabindex="-1"><a class="header-anchor" href="#安装portainer操作脚本"><span>安装portainer操作脚本</span></a></h2>`,4),d={href:"https://docs.portainer.io/v/ce-2.11/start/install/server/docker/linux",target:"_blank",rel:"noopener noreferrer"},u=t(`<div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># DockerStandalone</span>

<span class="token comment"># 默认方式</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8000</span>:8000 <span class="token parameter variable">-p</span> <span class="token number">9443</span>:9443 <span class="token parameter variable">--name</span> portainer <span class="token parameter variable">--restart</span><span class="token operator">=</span>always<span class="token punctuation">\\</span>
 <span class="token parameter variable">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="token punctuation">\\</span>
 <span class="token parameter variable">-v</span> portainer_data:/data portainer/portainer-ce:2.14.2

<span class="token comment"># 安装到特定网络 , net_default已经提前创建完成</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8000</span>:8000 <span class="token parameter variable">-p</span> <span class="token number">9000</span>:9000 <span class="token parameter variable">--name</span> portainer <span class="token parameter variable">--restart</span><span class="token operator">=</span>always<span class="token punctuation">\\</span>
 <span class="token parameter variable">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="token parameter variable">--network</span> net_default<span class="token punctuation">\\</span>
 <span class="token parameter variable">-v</span> portainer_data:/data portainer/portainer-ce:2.14.2
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="安装代理到已经存在的portainer" tabindex="-1"><a class="header-anchor" href="#安装代理到已经存在的portainer"><span>安装代理到已经存在的portainer</span></a></h2><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code> <span class="token comment"># Add an environment to an existing installation</span>
 <span class="token comment">## Docker Standalone</span>
 <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">10.10</span>.4.128:9001:9001 <span class="token parameter variable">--name</span> portainer_agent <span class="token parameter variable">--restart</span><span class="token operator">=</span>always<span class="token punctuation">\\</span>
  <span class="token parameter variable">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="token punctuation">\\</span>
  <span class="token parameter variable">-v</span> /var/lib/docker/volumes:/var/lib/docker/volumes portainer/agent:2.14.2
  
<span class="token comment"># Add k8s</span>
<span class="token function">curl</span> <span class="token parameter variable">-L</span> https://downloads.portainer.io/ee2-14/portainer-agent-k8s-nodeport.yaml <span class="token parameter variable">-o</span> portainer-agent-k8s.yaml<span class="token punctuation">;</span> 
kubectl apply <span class="token parameter variable">-f</span> portainer-agent-k8s.yaml

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="访问" tabindex="-1"><a class="header-anchor" href="#访问"><span>访问</span></a></h2>`,4),k=n("code",null,"docker",-1),m={href:"http://10.10.4.128:9000",target:"_blank",rel:"noopener noreferrer"},v=n("code",null,"k8s",-1),b={href:"http://10.10.4.128:30778",target:"_blank",rel:"noopener noreferrer"},h=t(`<h2 id="配置到ingress" tabindex="-1"><a class="header-anchor" href="#配置到ingress"><span>配置到ingress</span></a></h2><blockquote><p>portainer_ingress.yaml</p></blockquote><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> portainer
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> portainer
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">nginx.ingress.kubernetes.io/proxy-body-size</span><span class="token punctuation">:</span> <span class="token string">&quot;0&quot;</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> portainer.example.com
    <span class="token key atrule">http</span><span class="token punctuation">:</span>
      <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
        <span class="token key atrule">pathType</span><span class="token punctuation">:</span> Prefix
        <span class="token key atrule">backend</span><span class="token punctuation">:</span>
          <span class="token key atrule">service</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> portainer
            <span class="token key atrule">port</span><span class="token punctuation">:</span>
              <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">9000</span>
  <span class="token key atrule">ingressClassName</span><span class="token punctuation">:</span> nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ingress-访问地址" tabindex="-1"><a class="header-anchor" href="#ingress-访问地址"><span>ingress 访问地址</span></a></h2>`,4),g={href:"http://portainer.example.com",target:"_blank",rel:"noopener noreferrer"},y=t(`<h2 id="重置密码" tabindex="-1"><a class="header-anchor" href="#重置密码"><span>重置密码</span></a></h2><blockquote><p>某一天忘记密码或其他异常导致密码被动忘记掉</p></blockquote><ol><li><p>找到portainer的数据目录 <code>portainer_data:/data</code></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>docker安装用 <span class="token function">docker</span> inspect container_name or container_id 查看
     <span class="token string">&quot;Mounts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">..</span><span class="token punctuation">..</span>.
        <span class="token punctuation">{</span>
            <span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bind&quot;</span>,
            <span class="token string">&quot;Source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/data&quot;</span>,
            <span class="token string">&quot;Destination&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/data&quot;</span>,
            <span class="token string">&quot;Mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
            <span class="token string">&quot;RW&quot;</span><span class="token builtin class-name">:</span> true,
            <span class="token string">&quot;Propagation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;rprivate&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>,


k8s安装用 kubectl describe pods  portainer-5d4754696-ngdn6 <span class="token parameter variable">-n</span> portainer 查看 
    Volumes:
    data:
        Type:          HostPath <span class="token punctuation">(</span>bare <span class="token function">host</span> directory volume<span class="token punctuation">)</span>
        Path:          /data
        HostPathType:  Directory

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>上面找到的真实地址是 <code>/data</code></p></blockquote></li><li><p>关闭portainer</p></li><li><p>运行重置命令</p></li></ol><blockquote><p><code>docker run --rm -v /data:/data portainer/helper-reset-password</code></p></blockquote><div class="language-log line-numbers-mode" data-ext="log" data-title="log"><pre class="language-log"><code><span class="token operator">{</span><span class="token string">&quot;level&quot;</span><span class="token operator">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;filename&quot;</span><span class="token operator">:</span><span class="token string">&quot;portainer.db&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token operator">:</span><span class="token string">&quot;2024-03-28T01:10:00Z&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token operator">:</span><span class="token string">&quot;loading PortainerDB&quot;</span><span class="token operator">}</span>
<span class="token date number">2024/04/01</span> <span class="token time number">01:10:00</span> Password successfully updated for user<span class="token operator">:</span> admin
<span class="token date number">2024/04/01</span> <span class="token time number">01:10:00</span> Use the following password to login<span class="token operator">:</span> <span class="token operator">~</span><span class="token number">3</span><span class="token operator">%</span><span class="token number">2gWf</span><span class="token punctuation">,</span>hb<span class="token punctuation">[</span>n5<span class="token operator">$</span><span class="token number">4F</span><span class="token operator">:</span>UI0w78x<span class="token operator">!</span>QE<span class="token operator">{</span>l6Zt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>输出日志中包含有 <code>admin</code>的密码 <code>~3%2gWf,hb[n5$4F:UI0w78x!QE{l6Zt</code></p></blockquote><ol start="4"><li><p>启动portainer</p></li><li><p>输入上述密码 ，登录portainer后台，修改密码。</p></li></ol>`,7);function q(_,f){const s=r("ExternalLinkIcon");return i(),l("div",null,[c,n("blockquote",null,[n("p",null,[a("参考资料 "),n("a",d,[a("Linux install"),e(s)])])]),u,n("blockquote",null,[n("p",null,[a("访问地址： "),k,a(),n("a",m,[a("http://10.10.4.128:9000"),e(s)]),a(),v,a(),n("a",b,[a("http://10.10.4.128:30778"),e(s)])])]),h,n("blockquote",null,[n("p",null,[n("a",g,[a("http://portainer.example.com"),e(s)])])]),y])}const w=o(p,[["render",q],["__file","0f1110.html.vue"]]),D=JSON.parse(`{"path":"/p2024/Docker/0f1110.html","title":"porainer安装使用","lang":"zh-CN","frontmatter":{"permalink":"/p2024/Docker/0f1110.html","lang":"zh-CN","title":"porainer安装使用","description":"porainer安装使用","isOriginal":true,"date":"2024-03-29T00:00:00.000Z","category":["porainer"],"tag":["porainer"],"head":[["meta",{"name":"keywords","content":"porainer安装使用,porainer"}],["meta",{"property":"og:url","content":"https://hub.nstudy.org/p2024/Docker/0f1110.html"}],["meta",{"property":"og:site_name","content":"Jack's 新学习基地"}],["meta",{"property":"og:title","content":"porainer安装使用"}],["meta",{"property":"og:description","content":"porainer安装使用"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-12T06:52:02.000Z"}],["meta",{"property":"article:author","content":"Jack"}],["meta",{"property":"article:tag","content":"porainer"}],["meta",{"property":"article:published_time","content":"2024-03-29T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-04-12T06:52:02.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"porainer安装使用\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-03-29T00:00:00.000Z\\",\\"dateModified\\":\\"2024-04-12T06:52:02.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Jack\\",\\"url\\":\\"https://hub.nstudy.org\\"}]}"]],"star":true,"sticky":true},"headers":[{"level":2,"title":"机器环境","slug":"机器环境","link":"#机器环境","children":[]},{"level":2,"title":"安装portainer操作脚本","slug":"安装portainer操作脚本","link":"#安装portainer操作脚本","children":[]},{"level":2,"title":"安装代理到已经存在的portainer","slug":"安装代理到已经存在的portainer","link":"#安装代理到已经存在的portainer","children":[]},{"level":2,"title":"访问","slug":"访问","link":"#访问","children":[]},{"level":2,"title":"配置到ingress","slug":"配置到ingress","link":"#配置到ingress","children":[]},{"level":2,"title":"ingress 访问地址","slug":"ingress-访问地址","link":"#ingress-访问地址","children":[]},{"level":2,"title":"重置密码","slug":"重置密码","link":"#重置密码","children":[]}],"git":{"createdTime":1712904722000,"updatedTime":1712904722000,"contributors":[{"name":"lizhiquan","email":"lizhiquan@jianke.com","commits":1}]},"readingTime":{"minutes":1.69,"words":506},"filePathRelative":"02.Docker/20240329_porainer安装使用.md","localizedDate":"2024年3月29日","excerpt":"<h2>机器环境</h2>\\n<blockquote>\\n<p>本实践将在 Ubuntu 22.04.3LTS 系统上进行安装测试<br>\\ndocker 版本，原则上docker版本无影响</p>\\n</blockquote>\\n<div class=\\"language-bash\\" data-ext=\\"sh\\" data-title=\\"sh\\"><pre class=\\"language-bash\\"><code><span class=\\"token function\\">docker</span> version\\n\\nClient: Docker Engine - Community\\n Version:           <span class=\\"token number\\">24.0</span>.6\\n API version:       <span class=\\"token number\\">1.43</span>\\n Go version:        go1.20.7\\n Git commit:        ed223bc\\n Built:             Mon Sep  <span class=\\"token number\\">4</span> <span class=\\"token number\\">12</span>:31:44 <span class=\\"token number\\">2023</span>\\n OS/Arch:           linux/amd64\\n Context:           default\\n\\n</code></pre></div>"}`);export{w as comp,D as data};
