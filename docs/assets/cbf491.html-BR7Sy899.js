import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as o,o as c,c as l,a as n,b as s,d as t,e as p}from"./app-CRfAIpjY.js";const i={},u=n("h2",{id:"目的-封装一个通用的-java-框架的-chat-completion-接口-来适配各种大模型的统一调用",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#目的-封装一个通用的-java-框架的-chat-completion-接口-来适配各种大模型的统一调用"},[n("span",null,"目的：封装一个通用的 Java 框架的 chat completion 接口，来适配各种大模型的统一调用")])],-1),r=n("blockquote",null,[n("p",null,"限制条件：仅对聊天（文本）接口进行封装，其他接口待后续计划安排")],-1),k=n("h2",{id:"openai-chat-completion-接口分析",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#openai-chat-completion-接口分析"},[n("span",null,"OpenAi chat completion 接口分析")])],-1),d={href:"https://platform.openai.com/docs/api-reference/chat/create",target:"_blank",rel:"noopener noreferrer"},v=p(`<ul><li><h3 id="curl-默认请求" tabindex="-1"><a class="header-anchor" href="#curl-默认请求"><span>Curl 默认请求</span></a></h3></li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">curl</span> http://chat.xxxxxx.com/v1/chat/completions <span class="token punctuation">\\</span>
  <span class="token parameter variable">-H</span> <span class="token string">&quot;Content-Type: application/json&quot;</span> <span class="token punctuation">\\</span>
  <span class="token parameter variable">-H</span> <span class="token string">&quot;Authorization: Bearer <span class="token variable">$OPENAI_API_KEY</span>&quot;</span> <span class="token punctuation">\\</span>
  <span class="token parameter variable">-d</span> <span class="token string">&#39;{
    &quot;model&quot;: &quot;gpt-3.5-turbo&quot;,
    &quot;messages&quot;: [
      {
        &quot;role&quot;: &quot;system&quot;,
        &quot;content&quot;: &quot;You are a helpful assistant.&quot;
      },
      {
        &quot;role&quot;: &quot;user&quot;,
        &quot;content&quot;: &quot;Hello!&quot;
      }
    ]
  }&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>返回值</p></blockquote><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chatcmpl-123&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;object&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chat.completion&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;created&quot;</span><span class="token operator">:</span> <span class="token number">1677652288</span><span class="token punctuation">,</span>
  <span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gpt-3.5-turbo-0125&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;system_fingerprint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fp_44709d6fcb&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;choices&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;role&quot;</span><span class="token operator">:</span> <span class="token string">&quot;assistant&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\\n\\nHello there, how may I assist you today?&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;logprobs&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">&quot;finish_reason&quot;</span><span class="token operator">:</span> <span class="token string">&quot;stop&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;usage&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;prompt_tokens&quot;</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
    <span class="token property">&quot;completion_tokens&quot;</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
    <span class="token property">&quot;total_tokens&quot;</span><span class="token operator">:</span> <span class="token number">21</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><h3 id="python-流式请求" tabindex="-1"><a class="header-anchor" href="#python-流式请求"><span>Python 流式请求</span></a></h3></li></ul><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">from</span> openai <span class="token keyword">import</span> OpenAI
<span class="token comment"># client = OpenAI()</span>

client <span class="token operator">=</span> OpenAI<span class="token punctuation">(</span>
    base_url<span class="token operator">=</span><span class="token string">&#39;http://chat.xxxxxx.com/&#39;</span>
<span class="token punctuation">)</span>
completion <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
  model<span class="token operator">=</span><span class="token string">&quot;gpt-3.5-turbo&quot;</span><span class="token punctuation">,</span>
  messages<span class="token operator">=</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token string">&quot;role&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;system&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;content&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;You are a helpful assistant.&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;role&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;content&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Hello!&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  stream<span class="token operator">=</span><span class="token boolean">True</span>
<span class="token punctuation">)</span>

<span class="token keyword">for</span> chunk <span class="token keyword">in</span> completion<span class="token punctuation">:</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>chunk<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>delta<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>返回值</p></blockquote><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chatcmpl-123&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;object&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chat.completion.chunk&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;created&quot;</span><span class="token operator">:</span> <span class="token number">1694268190</span><span class="token punctuation">,</span>
	<span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gpt-3.5-turbo-0125&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;system_fingerprint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fp_44709d6fcb&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;choices&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token punctuation">{</span>
			<span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
			<span class="token property">&quot;delta&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token property">&quot;role&quot;</span><span class="token operator">:</span> <span class="token string">&quot;assistant&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token property">&quot;logprobs&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
			<span class="token property">&quot;finish_reason&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token punctuation">{</span>
	<span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chatcmpl-123&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;object&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chat.completion.chunk&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;created&quot;</span><span class="token operator">:</span> <span class="token number">1694268190</span><span class="token punctuation">,</span>
	<span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gpt-3.5-turbo-0125&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;system_fingerprint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fp_44709d6fcb&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;choices&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token punctuation">{</span>
			<span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
			<span class="token property">&quot;delta&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Hello&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token property">&quot;logprobs&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
			<span class="token property">&quot;finish_reason&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

....

<span class="token punctuation">{</span>
	<span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chatcmpl-123&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;object&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chat.completion.chunk&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;created&quot;</span><span class="token operator">:</span> <span class="token number">1694268190</span><span class="token punctuation">,</span>
	<span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gpt-3.5-turbo-0125&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;system_fingerprint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fp_44709d6fcb&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;choices&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token punctuation">{</span>
			<span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
			<span class="token property">&quot;delta&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token property">&quot;logprobs&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
			<span class="token property">&quot;finish_reason&quot;</span><span class="token operator">:</span> <span class="token string">&quot;stop&quot;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="请求参数分析" tabindex="-1"><a class="header-anchor" href="#请求参数分析"><span>请求参数分析</span></a></h3><ul><li><p><span style="color:red;">model </span> 选填，默认为 gpt-3.5-turbo</p></li><li><p><span style="color:red;">messages</span> 必填</p></li></ul><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token property">&quot;role&quot;</span><span class="token operator">:</span> <span class="token string">&quot;system&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;You are a helpful assistant.&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token property">&quot;role&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Hello!&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><hr></blockquote><ul><li>stream 选填，默认为 false</li></ul>`,13),m={href:"https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events",target:"_blank",rel:"noopener noreferrer"},b=n("span",{style:{color:"red"}}," data: [DONE] ",-1),q=p('<ul><li>temperature 选填，默认为 1</li></ul><blockquote><p>What sampling temperature to use, between 0 and 2. Higher values like 0.8 will make the output more random, while lower values like 0.2 will make it more focused and deterministic.</p></blockquote><blockquote><p><span style="color:red;">使用什么样的采样温度，在 0 到 2 之间。较高的值，比如 0.8，会使输出更随机，而较低的值，比如 0.2，会使其更加聚焦和确定性。</span></p></blockquote><blockquote><p>We generally recommend altering this or top_p but not both.</p></blockquote><blockquote><p><span style="color:red;">我们一般建议修改这个参数或者 top_p，但不要同时修改两者。</span></p></blockquote><ul><li>top_p 选填，默认为 1</li></ul><blockquote><p>An alternative to sampling with temperature, called nucleus sampling, where the model considers the results of the tokens with top_p probability mass. So 0.1 means only the tokens comprising the top 10% probability mass are considered.</p></blockquote><blockquote><p><span style="color:red;">一种与温度采样相对应的替代方法是核心采样，模型会考虑具有 top_p 概率质量的标记的结果。因此，0.1 表示仅考虑构成顶部 10% 概率质量的标记。</span></p></blockquote><blockquote><p>We generally recommend altering this or temperature but not both.</p></blockquote><blockquote><p><span style="color:red;">我们一般建议修改这个参数或者温度，但不要同时修改两者。</span></p></blockquote><h3 id="其他可能用到的请求参数" tabindex="-1"><a class="header-anchor" href="#其他可能用到的请求参数"><span>其他可能用到的请求参数</span></a></h3><ul><li>max_tokens 选填，无默认值</li></ul><blockquote><p>The maximum number of tokens that can be generated in the chat completion.</p></blockquote><ul><li>n integer or null 选填，默认值 1</li></ul><blockquote><p>How many chat completion choices to generate for each input message. Note that you will be charged based on the number of generated tokens across all of the choices. Keep n as 1 to minimize costs.</p></blockquote><h3 id="输出参数对比-默认和流式结果" tabindex="-1"><a class="header-anchor" href="#输出参数对比-默认和流式结果"><span>输出参数对比(默认和流式结果)</span></a></h3>',16),g=n("p",null,"流式结果没有 usage 字段，要计算token数需要额外计算，官方并未提供相关方法",-1),y={href:"https://cookbook.openai.com/examples/how_to_stream_completions",target:"_blank",rel:"noopener noreferrer"},h=n("blockquote",null,[n("p",null,"Another small drawback of streaming responses is that the response no longer includes the usage field to tell you how many tokens were consumed. After receiving and combining all of the responses, you can calculate this yourself using tiktoken.")],-1),f=n("span",{style:{color:"red"}},"python库",-1),w={href:"https://cookbook.openai.com/examples/How_to_count_tokens_with_tiktoken.ipynb",target:"_blank",rel:"noopener noreferrer"},x=n("li",null,[n("p",null,"普通请求结果的 choices 字段中的 message 用 delta 字段代替")],-1),_=n("h2",{id:"灵医bot-chat-接口分析",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#灵医bot-chat-接口分析"},[n("span",null,"灵医Bot Chat 接口分析")])],-1),S=n("blockquote",null,[n("p",null,[n("em",null,"接口路径 /api/01bot/sse-gateway/stream")])],-1),j={href:"https://github.com/r3labs/sse",target:"_blank",rel:"noopener noreferrer"},L=p(`<h3 id="header参数" tabindex="-1"><a class="header-anchor" href="#header参数"><span>Header参数</span></a></h3><table><thead><tr><th>名称</th><th>示例</th><th>类型</th><th>必选</th><th>说明</th></tr></thead><tbody><tr><td>Content-Type</td><td>application/json</td><td>string</td><td>是</td><td>Content-Type类型</td></tr><tr><td>X-IHU-Authorization-V2</td><td>参考《鉴权认证文档》</td><td>string</td><td>是</td><td>签名字符串</td></tr></tbody></table><h3 id="非流式请求示例-单轮-参数" tabindex="-1"><a class="header-anchor" href="#非流式请求示例-单轮-参数"><span>非流式请求示例（单轮）参数</span></a></h3><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test-model&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;stream&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;messages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;version&quot;</span><span class="token operator">:</span><span class="token string">&quot;api-v2&quot;</span><span class="token punctuation">,</span>       
            <span class="token property">&quot;created&quot;</span><span class="token operator">:</span> <span class="token number">1683944235</span><span class="token punctuation">,</span>              
            <span class="token property">&quot;role&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span>                    
            <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                <span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;body&quot;</span><span class="token operator">:</span><span class="token string">&quot;患者3天前面部肿胀伴多发红疹，自觉瘙痒，是什么疾病？&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span>                       
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><span style="color:red;">与OpenAi区别</span><br> messages 字段多了 version created 字段</p></blockquote><blockquote><p>文档中message 参数中有 default 参数必填 (兜底开关，用于兜底策略：0：不兜底 1：一言兜底) <span style="color:red;">但是给出的示例中未体现</span></p></blockquote><blockquote><p>content 内容结构不同, 有 string 改成 实体类型(type, body)</p></blockquote><h3 id="非流式响应参数-单轮" tabindex="-1"><a class="header-anchor" href="#非流式响应参数-单轮"><span>非流式响应参数（单轮）</span></a></h3><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;error_msg&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;logid&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;need_clear_history&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ban_round&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;result&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;messages&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token property">&quot;extend&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span><span class="token string">&quot;api-v2&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;role&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;intention&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;content&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
                        <span class="token punctuation">{</span>
                            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
                            <span class="token property">&quot;body&quot;</span><span class="token operator">:</span>&quot;我不是医生或医疗专家，不能提供专业的医疗建议或诊断，以下信息仅供参考：
                            根据您提供的患者信息，可能的诊断是湿疹，荨麻疹；
                            诊断依据<span class="token operator">:</span>
                            <span class="token number">1</span>. 患者<span class="token number">3</span>天前面部肿胀伴多发红疹，自觉瘙痒，提示患者有皮肤过敏反应；
                            <span class="token number">2</span>. 病历中未提及患者有发热、关节痛等症状，因此可以排除结节性红斑的可能性。
                            此外建议您补充以下检查<span class="token operator">:</span>
                            <span class="token number">1</span>. 血常规检查：了解是否有感染或炎症反应；
                            <span class="token number">2</span>. 过敏原检测：了解过敏原，为治疗提供依据。&quot;
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;created&quot;</span><span class="token operator">:</span><span class="token number">0</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;created&quot;</span><span class="token operator">:</span><span class="token number">0</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;error_code&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;user_id&quot;</span><span class="token operator">:</span><span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>响应结果与OpenAi结构差异较大<br><span style="color:red;">extend 额外响应参数 string 响应额外参数 参考示例为空</span><br><span style="color:red;">intention body string 当前对话意图信息 参考示例为空</span></p></blockquote><h3 id="非流式请求示例-多轮" tabindex="-1"><a class="header-anchor" href="#非流式请求示例-多轮"><span>非流式请求示例（多轮）</span></a></h3><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test-model&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;stream&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;messages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;version&quot;</span><span class="token operator">:</span><span class="token string">&quot;api-v2&quot;</span><span class="token punctuation">,</span>       
            <span class="token property">&quot;created&quot;</span><span class="token operator">:</span> <span class="token number">1683944235</span><span class="token punctuation">,</span>              
            <span class="token property">&quot;role&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span>                    
            <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                <span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;body&quot;</span><span class="token operator">:</span><span class="token string">&quot;患者3天前面部肿胀伴多发红疹，自觉瘙痒，是什么疾病？&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span>                       
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;version&quot;</span><span class="token operator">:</span><span class="token string">&quot;api-v2&quot;</span><span class="token punctuation">,</span>       
            <span class="token property">&quot;created&quot;</span><span class="token operator">:</span> <span class="token number">1683944235</span><span class="token punctuation">,</span>              
            <span class="token property">&quot;role&quot;</span><span class="token operator">:</span> <span class="token string">&quot;assistant&quot;</span><span class="token punctuation">,</span>                    
            <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                <span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;body&quot;</span><span class="token operator">:</span>&quot;我不是医生或医疗专家，不能提供专业的医疗建议或诊断，以下信息仅供参考：
                根据您提供的患者信息，可能的诊断是湿疹，荨麻疹；
                诊断依据<span class="token operator">:</span>
                <span class="token number">1</span>. 患者<span class="token number">3</span>天前面部肿胀伴多发红疹，自觉瘙痒，提示患者有皮肤过敏反应；
                <span class="token number">2</span>. 病历中未提及患者有发热、关节痛等症状，因此可以排除结节性红斑的可能性。
                此外建议您补充以下检查<span class="token operator">:</span>
                <span class="token number">1</span>. 血常规检查：了解是否有感染或炎症反应；
                <span class="token number">2</span>. 过敏原检测：了解过敏原，为治疗提供依据。&quot;
            <span class="token punctuation">}</span><span class="token punctuation">]</span>                       
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;version&quot;</span><span class="token operator">:</span><span class="token string">&quot;api-v2&quot;</span><span class="token punctuation">,</span>       
            <span class="token property">&quot;created&quot;</span><span class="token operator">:</span> <span class="token number">1683944235</span><span class="token punctuation">,</span>              
            <span class="token property">&quot;role&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span>                    
            <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                <span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;body&quot;</span><span class="token operator">:</span><span class="token string">&quot;应该吃什么药？&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span>                       
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="非流式响应参数-多轮" tabindex="-1"><a class="header-anchor" href="#非流式响应参数-多轮"><span>非流式响应参数（多轮）</span></a></h3><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;error_msg&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;logid&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;need_clear_history&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ban_round&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;result&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;messages&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token property">&quot;extend&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span><span class="token string">&quot;api-v2&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;role&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;intention&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;content&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
                        <span class="token punctuation">{</span>
                            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
                            <span class="token property">&quot;body&quot;</span><span class="token operator">:</span>&quot;我无法作为医学专业人员为您提供用药指导，推荐结果仅供参考。
                            <span class="token number">1</span>. 湿疹：湿疹是一种常见的皮肤疾病，通常表现为皮肤上的红斑、丘疹和水疱等症状。推荐使用非处方药氢化可的松乳膏或地奈德乳膏，它们可以缓解湿疹引起的瘙痒和炎症。如果症状严重或持续时间较长，建议咨询医生并使用处方药。
                            <span class="token number">2</span>. 荨麻疹：荨麻疹通常表现为皮肤上的瘙痒性风团，推荐使用非处方药氯雷他定或西替利嗪，它们可以缓解荨麻疹引起的瘙痒和红肿。如果症状严重或持续时间较长，建议咨询医生并使用处方药。
                            请您在必要时咨询医学相关专业人士意见；同时，也要注意药品的使用方法和剂量，以免造成不良后果。&quot;
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;created&quot;</span><span class="token operator">:</span><span class="token number">0</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;created&quot;</span><span class="token operator">:</span><span class="token number">0</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;error_code&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;user_id&quot;</span><span class="token operator">:</span><span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="请求示例-流式" tabindex="-1"><a class="header-anchor" href="#请求示例-流式"><span>请求示例（流式）</span></a></h3><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test-model&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;stream&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;messages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;version&quot;</span><span class="token operator">:</span><span class="token string">&quot;api-v2&quot;</span><span class="token punctuation">,</span>       
            <span class="token property">&quot;created&quot;</span><span class="token operator">:</span> <span class="token number">1683944235</span><span class="token punctuation">,</span>              
            <span class="token property">&quot;role&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span>                    
            <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                <span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;body&quot;</span><span class="token operator">:</span><span class="token string">&quot;患者3天前面部肿胀伴多发红疹，自觉瘙痒，是什么疾病？&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span>                       
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="响应示例-流式" tabindex="-1"><a class="header-anchor" href="#响应示例-流式"><span>响应示例（流式）</span></a></h3><blockquote><p>第一轮返回,其他返回类似，最后一轮返回is_end字段为true，标识整个对话回答返回结束</p></blockquote><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token property">&quot;event&quot;</span><span class="token operator">:</span><span class="token string">&quot;message&quot;</span>
<span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;error_msg&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;logid&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;is_end&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sentence_id&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;need_clear_history&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ban_round&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;result&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;messages&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token property">&quot;extend&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span><span class="token string">&quot;api-v2&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;role&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;intention&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;content&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
                        <span class="token punctuation">{</span>
                            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
                            <span class="token property">&quot;body&quot;</span><span class="token operator">:</span><span class="token string">&quot;xxxxxxxx&quot;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;created&quot;</span><span class="token operator">:</span><span class="token number">0</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;created&quot;</span><span class="token operator">:</span><span class="token number">0</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;error_code&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;user_id&quot;</span><span class="token operator">:</span><span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="请求示例-java" tabindex="-1"><a class="header-anchor" href="#请求示例-java"><span>请求示例 Java</span></a></h3><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token class-name">Mac</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>spec<span class="token punctuation">.</span></span><span class="token class-name">SecretKeySpec</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>net<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span></span><span class="token class-name">HttpsURLConnection</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">UnsupportedEncodingException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">MessageDigest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">NoSuchAlgorithmException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">DateFormat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">SimpleDateFormat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson2<span class="token punctuation">.</span></span><span class="token class-name">JSONObject</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">BufferedReader</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">DataOutputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStreamReader</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URL</span></span><span class="token punctuation">;</span>

<span class="token comment">// Press Shift twice to open the Search Everywhere dialog and type \`show whitespaces\`,</span>
<span class="token comment">// then press Enter. You can now see whitespace characters in your code.</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> ak <span class="token operator">=</span> <span class="token string">&quot;替换成申请的AK&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> sk <span class="token operator">=</span> <span class="token string">&quot;替换成申请的SK&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getMd5</span><span class="token punctuation">(</span><span class="token class-name">String</span> data<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchAlgorithmException</span><span class="token punctuation">,</span> <span class="token class-name">UnsupportedEncodingException</span> <span class="token punctuation">{</span>
        <span class="token class-name">MessageDigest</span> md <span class="token operator">=</span> <span class="token class-name">MessageDigest</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">&quot;MD5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        md<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> digest <span class="token operator">=</span> md<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">byte</span> b <span class="token operator">:</span> digest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%02x&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">string2Unicode</span><span class="token punctuation">(</span><span class="token class-name">String</span> string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StringBuffer</span> unicode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bytes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">char</span> c <span class="token operator">=</span> bytes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token comment">// 标准ASCII范围内的字符，直接输出</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> c <span class="token operator">&lt;=</span> <span class="token number">127</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                unicode<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">String</span> hexString <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>bytes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            unicode<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\u&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 不够四位进行补0操作</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>hexString<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                unicode<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;0000&quot;</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>hexString<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            unicode<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>hexString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> unicode<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">hmacSha256</span><span class="token punctuation">(</span><span class="token class-name">String</span> secret<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchAlgorithmException</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">SecretKeySpec</span> secretKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecretKeySpec</span><span class="token punctuation">(</span>secret<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;HmacSHA256&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Mac</span> mac <span class="token operator">=</span> <span class="token class-name">Mac</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">&quot;HmacSHA256&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mac<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>secretKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> rawHmac <span class="token operator">=</span> mac<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">byte</span> b <span class="token operator">:</span> rawHmac<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%02x&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to calculate HMAC-SHA256&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> message <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> model<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Message</span> <span class="token punctuation">{</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> version<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">long</span> created<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> role<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Content</span><span class="token punctuation">&gt;</span></span> content<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setVersion</span><span class="token punctuation">(</span><span class="token class-name">String</span> version<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>version <span class="token operator">=</span> version<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> version<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCreated</span><span class="token punctuation">(</span><span class="token keyword">long</span> created<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>created <span class="token operator">=</span> created<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getCreated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> created<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRole</span><span class="token punctuation">(</span><span class="token class-name">String</span> role<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>role <span class="token operator">=</span> role<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getRole</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> role<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setContent</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Content</span><span class="token punctuation">&gt;</span></span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>content <span class="token operator">=</span> content<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Content</span><span class="token punctuation">&gt;</span></span> <span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> content<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>



    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Content</span> <span class="token punctuation">{</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> type<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> body<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">String</span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> type<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBody</span><span class="token punctuation">(</span><span class="token class-name">String</span> body<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>body <span class="token operator">=</span> body<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> body<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MessageBean</span> <span class="token punctuation">{</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> model<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> stream<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setStream</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> stream<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>stream <span class="token operator">=</span> stream<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">boolean</span> stream<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> messages<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setModel</span><span class="token punctuation">(</span><span class="token class-name">String</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>model <span class="token operator">=</span> model<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> model<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMessages</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> messages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>messages <span class="token operator">=</span> messages<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> <span class="token function">getMessages</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> messages<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">MessageBean</span> messageBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        messageBean<span class="token punctuation">.</span><span class="token function">setModel</span><span class="token punctuation">(</span><span class="token string">&quot;替换成申请的model&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        messageBean<span class="token punctuation">.</span><span class="token function">setStream</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Message</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> messages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        message<span class="token punctuation">.</span><span class="token function">setRole</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        message<span class="token punctuation">.</span><span class="token function">setCreated</span><span class="token punctuation">(</span><span class="token number">1683944235</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        message<span class="token punctuation">.</span><span class="token function">setVersion</span><span class="token punctuation">(</span><span class="token string">&quot;api-v2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Content</span><span class="token punctuation">&gt;</span></span> contents <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Content</span> content <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        content<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        content<span class="token punctuation">.</span><span class="token function">setBody</span><span class="token punctuation">(</span><span class="token string">&quot;阿莫西林应该怎么吃&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        contents<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
        message<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span>contents<span class="token punctuation">)</span><span class="token punctuation">;</span>
        messages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        messageBean<span class="token punctuation">.</span><span class="token function">setMessages</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> messageJson <span class="token operator">=</span> <span class="token class-name">JSONObject</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>messageBean<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>messageJson<span class="token punctuation">)</span><span class="token punctuation">;</span>
        messageJson <span class="token operator">=</span> <span class="token function">string2Unicode</span><span class="token punctuation">(</span>messageJson<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> md5 <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            md5 <span class="token operator">=</span> <span class="token function">getMd5</span><span class="token punctuation">(</span>messageJson<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchAlgorithmException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Cannot get content md5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">DateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;dd MMM yyyy HH:mm:ss &#39;GMT&#39;&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token constant">US</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> trimester <span class="token operator">=</span> sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> authStringPrefix <span class="token operator">=</span> <span class="token string">&quot;ihcloud/&quot;</span> <span class="token operator">+</span> ak <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> trimester <span class="token operator">+</span> <span class="token string">&quot;/300&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> signingKey <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            signingKey <span class="token operator">=</span> <span class="token function">hmacSha256</span><span class="token punctuation">(</span>sk<span class="token punctuation">,</span> authStringPrefix<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchAlgorithmException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Cannot get content md5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">String</span> host <span class="token operator">=</span> <span class="token string">&quot;替换成当前环境的host，线上环境是https://01bot.baidu.com&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token string">&quot;/api/01bot/sse-gateway/stream&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> url <span class="token operator">=</span> host <span class="token operator">+</span> path<span class="token punctuation">;</span>
        <span class="token class-name">URL</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> canonicalRequest <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;\\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;content-md5:&quot;</span> <span class="token operator">+</span> md5<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> signature <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            signature <span class="token operator">=</span> <span class="token function">hmacSha256</span><span class="token punctuation">(</span>signingKey<span class="token punctuation">,</span> canonicalRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchAlgorithmException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;gen signature failed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">HttpsURLConnection</span> con <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpsURLConnection</span><span class="token punctuation">)</span> obj<span class="token punctuation">.</span><span class="token function">openConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//添加请求头</span>
        con<span class="token punctuation">.</span><span class="token function">setRequestMethod</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        con<span class="token punctuation">.</span><span class="token function">setRequestProperty</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        con<span class="token punctuation">.</span><span class="token function">setRequestProperty</span><span class="token punctuation">(</span><span class="token string">&quot;X-IHU-Authorization-V2&quot;</span><span class="token punctuation">,</span> authStringPrefix <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> signature<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//发送Post请求</span>
        con<span class="token punctuation">.</span><span class="token function">setDoOutput</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataOutputStream</span> wr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>con<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        wr<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>messageJson<span class="token punctuation">)</span><span class="token punctuation">;</span>
        wr<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        wr<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> responseCode <span class="token operator">=</span> con<span class="token punctuation">.</span><span class="token function">getResponseCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Response Code : &quot;</span> <span class="token operator">+</span> responseCode<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">BufferedReader</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>con<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> inputLine<span class="token punctuation">;</span>
        <span class="token class-name">StringBuffer</span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>inputLine <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            response<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>inputLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//打印结果</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h3><blockquote><p>请求结构体差距较小,字段有多出来,结构体有变化 , 后续其他大模型接入差距会更大</p></blockquote><blockquote><p>不同大模型返回结果差异较大</p></blockquote><blockquote><p>多轮对话需要自己构造 message的对话历史（指数级消耗token）<br><span style="color:red;">多轮对话需要完善的对话历史管理(用户/会话)才能实现,且会话长度需要控制。目前未考虑实现。</span></p></blockquote><blockquote><p>灵医Bot Chat 的签名验证方法比较复杂，每次请求需要重新计算签名，需要资源比较多。封装统一接口适配比普通接口额外处理较多。</p></blockquote><h2 id="拟定义的统一接口契约" tabindex="-1"><a class="header-anchor" href="#拟定义的统一接口契约"><span><span style="color:red;">拟定义的统一接口契约</span></span></a></h2><blockquote><p>统一接口不考虑权限认证，默认在安全环境下使用</p></blockquote><h3 id="入参-请求参数" tabindex="-1"><a class="header-anchor" href="#入参-请求参数"><span>入参（请求参数）</span></a></h3><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;systemId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1234567890&quot;</span><span class="token punctuation">,</span> # string 不为空<span class="token punctuation">,</span> 给出系统请求的标识(统计权限控制等使用) ; 第一个版本可随机传<span class="token punctuation">,</span>后端服务不做控制
    <span class="token property">&quot;userId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1234567890&quot;</span><span class="token punctuation">,</span> # string 不为空<span class="token punctuation">,</span> 给出用户请求的标识(统计或会话等使用)     ; 第一个版本可随机传<span class="token punctuation">,</span>后端服务不做控制

    <span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;baidu_01bot&quot;</span><span class="token punctuation">,</span>  # 大模型名称 string 厂商_大模型名称 第一个版本支持  <span class="token punctuation">[</span>baidu_01bot<span class="token punctuation">]</span>
    <span class="token property">&quot;stream&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> # 是否为流式请求 bool 默认 <span class="token boolean">false</span>
    <span class="token property">&quot;messages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> # 请求消息列表 list 非空 <span class="token punctuation">{</span> <span class="token property">&quot;role&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;system&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;assistant&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;content&quot;</span><span class="token operator">:</span><span class="token string">&quot;string&quot;</span><span class="token punctuation">}</span>
        <span class="token punctuation">{</span>             
            <span class="token property">&quot;role&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span>                    
            <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;患者3天前面部肿胀伴多发红疹，自觉瘙痒，是什么疾病？&quot;</span>                       
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> # 额外参数 map 可为空 (针对不同的大模型提供 最外层参数 的额外参数扩展)
        <span class="token property">&quot;key1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;values1&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;key2&quot;</span><span class="token operator">:</span> <span class="token number">22.52</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><h4 id="假如openai-额外参数说明如下且服务端已经支持" tabindex="-1"><a class="header-anchor" href="#假如openai-额外参数说明如下且服务端已经支持"><span>假如OpenAI 额外参数说明如下且服务端已经支持</span></a></h4></blockquote><blockquote><p>   1. temperature float [0,2]<br>    2. top_p float [0,1]</p></blockquote><blockquote><p>请求的时候额外参数例子如下 , 注意官方建议不建议两个参数同时使用 , 这里仅仅为了示例参数的写法</p></blockquote><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code> <span class="token property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;temperature&quot;</span><span class="token operator">:</span> <span class="token number">1.2</span><span class="token punctuation">,</span>
        <span class="token property">&quot;top_p&quot;</span><span class="token operator">:</span> <span class="token number">0.5</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><h4 id="额外的参数需要接口适配器支持才可以使用" tabindex="-1"><a class="header-anchor" href="#额外的参数需要接口适配器支持才可以使用"><span>额外的参数需要接口适配器支持才可以使用</span></a></h4></blockquote><h3 id="返回参数-默认响应-返回结果" tabindex="-1"><a class="header-anchor" href="#返回参数-默认响应-返回结果"><span>返回参数 - 默认响应 (返回结果)</span></a></h3><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;success&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> # bool 是否成功<span class="token punctuation">,</span>

    <span class="token property">&quot;seqId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;guid&quot;</span><span class="token punctuation">,</span> # 序列id string<span class="token punctuation">,</span>

    <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  # int <span class="token number">0</span><span class="token operator">:</span>成功<span class="token punctuation">,</span> 其他<span class="token operator">:</span>失败代码 <span class="token punctuation">,</span>
    <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span> # string 成功/失败的信息
    <span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;baidu_01bot&quot;</span><span class="token punctuation">,</span>  # 大模型名称 string
    <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;role&quot;</span><span class="token operator">:</span> <span class="token string">&quot;assistant&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> &quot;我不是医生或医疗专家，不能提供专业的医疗建议或诊断，以下信息仅供参考：
                            根据您提......&quot;<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> # 附加的响应参数 map <span class="token punctuation">,</span> 针对扩展功能预留
        <span class="token property">&quot;key1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;values1&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><h4 id="extra-参数说明" tabindex="-1"><a class="header-anchor" href="#extra-参数说明"><span>extra 参数说明</span></a></h4></blockquote><blockquote><p>假如 01bot 外层多返回了 intention 当前会话意图 , 且客户端已经支持解析,则extra返回如下</p></blockquote><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code> <span class="token property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;intention&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span> # 当前会话意图
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><h4 id="额外的响应参数需要接口响应适配支持才可以使用" tabindex="-1"><a class="header-anchor" href="#额外的响应参数需要接口响应适配支持才可以使用"><span>额外的响应参数需要接口响应适配支持才可以使用</span></a></h4></blockquote><h3 id="返回参数-流式响应-返回结果" tabindex="-1"><a class="header-anchor" href="#返回参数-流式响应-返回结果"><span>返回参数 - 流式响应 (返回结果)</span></a></h3>`,42),M={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Server-sent_events/Using_server-sent_events",target:"_blank",rel:"noopener noreferrer"},C=p(`<blockquote><p><span style="color:red;">除ended外,data 结构 和 默认响应 result 结构一样</span></p></blockquote><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token property">&quot;event&quot;</span><span class="token operator">:</span><span class="token string">&quot;message&quot;</span>
<span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;success&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> # bool 是否成功<span class="token punctuation">,</span>

    <span class="token property">&quot;seqId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;guid&quot;</span><span class="token punctuation">,</span> # 序列id string<span class="token punctuation">,</span>

    <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  # int <span class="token number">0</span><span class="token operator">:</span>成功<span class="token punctuation">,</span> 其他<span class="token operator">:</span>失败代码 <span class="token punctuation">,</span>
    <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span> # string 成功/失败的信息
    <span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;baidu_01bot&quot;</span><span class="token punctuation">,</span>  # 大模型名称 string

    <span class="token property">&quot;ended&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> # bool 是否结束流式请求 <span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token operator">:</span>结束流式请求 <span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token operator">:</span>继续流式请求 <span class="token punctuation">,</span>
    <span class="token property">&quot;result&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;role&quot;</span><span class="token operator">:</span> <span class="token string">&quot;assistant&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> &quot;我不是医生或医疗专家，不能提供专业的医疗建议或诊断，以下信息仅供参考：
                            根据您提......&quot;<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> # 附加的响应参数 map <span class="token punctuation">,</span> 针对扩展功能预留
        <span class="token property">&quot;key1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;values1&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><h4 id="extra-参数说明-注意-此处介绍数组使用方法" tabindex="-1"><a class="header-anchor" href="#extra-参数说明-注意-此处介绍数组使用方法"><span>extra 参数说明 <span style="color:red;">注意!! 此处介绍数组使用方法</span></span></a></h4></blockquote><blockquote><p>假如 01bot 的 result 的每个结果多返回了intention会话意图 , 要表达每个结果的会话意图,则extra返回如下</p></blockquote><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code> <span class="token property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;intentions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;string&quot;</span><span class="token punctuation">]</span> # result结果的每个会话意图 <span class="token punctuation">,</span> 数组长度和result长度一致
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="extra-约定事项" tabindex="-1"><a class="header-anchor" href="#extra-约定事项"><span>extra 约定事项</span></a></h3><blockquote><p>Java为面向对象语言, 当extra 响应结果为空时，返回结果为</p></blockquote><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="返回参数-流式响应-返回结果-1" tabindex="-1"><a class="header-anchor" href="#返回参数-流式响应-返回结果-1"><span>返回参数 - 流式响应 (返回结果)</span></a></h3><h2 id="特别说明" tabindex="-1"><a class="header-anchor" href="#特别说明"><span>特别说明</span></a></h2><blockquote><p><span style="color:red;">不同大模型接口返回结构差异较大，请求参数也不尽相同，为实现不同目的，需要新增不同参数对应不同的大模型</span></p></blockquote><blockquote><p>虽然设计已经考虑尽可能适配不同大模型，但使用场景需求的变化和大模型接口的调整，<span style="color:red;">会导致入参和返回参数后续大概率会有变动</span></p></blockquote>`,12);function A(B,H){const a=o("ExternalLinkIcon");return c(),l("div",null,[u,r,k,n("blockquote",null,[n("p",null,[n("em",null,[s("==>"),n("a",d,[s("官方文档"),t(a)])])])]),v,n("blockquote",null,[n("p",null,[s("If set, partial message deltas will be sent, like in ChatGPT. Tokens will be sent as data-only "),n("a",m,[s("server-sent events"),t(a)]),s(" as they become available, with the stream terminated by a "),b,s("message")])]),q,n("ul",null,[n("li",null,[g,n("blockquote",null,[n("p",null,[s("计算token 的 "),n("em",null,[n("a",y,[s("官方介绍"),t(a)])])])]),h,n("blockquote",null,[n("p",null,[n("em",null,[f,s(),n("a",w,[s("tiktoken使用方法"),t(a)])])])])]),x]),_,S,n("blockquote",null,[n("p",null,[s("灵医Bot Chat 提供 如果是服务端调用，参考 "),n("a",j,[s("Server Sent Events server and client for Golang"),t(a)])])]),L,n("blockquote",null,[n("p",null,[n("em",null,[n("a",M,[s("SSE规范参考"),t(a)])])])]),C])}const T=e(i,[["render",A],["__file","cbf491.html.vue"]]),E=JSON.parse(`{"path":"/p2024/01/01/cbf491.html","title":"LLM大模型统一封装接口解决方案","lang":"zh-CN","frontmatter":{"permalink":"/p2024/01/01/cbf491.html","lang":"zh-CN","title":"LLM大模型统一封装接口解决方案","description":"LLM大模型统一封装接口解决方案","isOriginal":true,"date":"2024-03-05T00:00:00.000Z","category":["机器学习","大模型","LLM","LLM大模型统一封装接口解决方案","解决方案"],"tag":["机器学习","大模型","LLM","LLM大模型统一封装接口解决方案","解决方案"],"head":[["meta",{"name":"keywords","content":"机器学习,人工智能,LLM,大模型,LLM大模型统一封装接口解决方案,解决方案"}],["meta",{"property":"og:url","content":"https://hub.nstudy.org/p2024/01/01/cbf491.html"}],["meta",{"property":"og:site_name","content":"Jack's 新学习基地"}],["meta",{"property":"og:title","content":"LLM大模型统一封装接口解决方案"}],["meta",{"property":"og:description","content":"LLM大模型统一封装接口解决方案"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-09T03:22:27.000Z"}],["meta",{"property":"article:author","content":"Jack"}],["meta",{"property":"article:tag","content":"机器学习"}],["meta",{"property":"article:tag","content":"大模型"}],["meta",{"property":"article:tag","content":"LLM"}],["meta",{"property":"article:tag","content":"LLM大模型统一封装接口解决方案"}],["meta",{"property":"article:tag","content":"解决方案"}],["meta",{"property":"article:published_time","content":"2024-03-05T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-04-09T03:22:27.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"LLM大模型统一封装接口解决方案\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-03-05T00:00:00.000Z\\",\\"dateModified\\":\\"2024-04-09T03:22:27.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Jack\\",\\"url\\":\\"https://hub.nstudy.org\\"}]}"]],"star":true,"sticky":true},"headers":[{"level":2,"title":"目的：封装一个通用的 Java 框架的 chat completion 接口，来适配各种大模型的统一调用","slug":"目的-封装一个通用的-java-框架的-chat-completion-接口-来适配各种大模型的统一调用","link":"#目的-封装一个通用的-java-框架的-chat-completion-接口-来适配各种大模型的统一调用","children":[]},{"level":2,"title":"OpenAi chat completion 接口分析","slug":"openai-chat-completion-接口分析","link":"#openai-chat-completion-接口分析","children":[{"level":3,"title":"请求参数分析","slug":"请求参数分析","link":"#请求参数分析","children":[]},{"level":3,"title":"其他可能用到的请求参数","slug":"其他可能用到的请求参数","link":"#其他可能用到的请求参数","children":[]},{"level":3,"title":"输出参数对比(默认和流式结果)","slug":"输出参数对比-默认和流式结果","link":"#输出参数对比-默认和流式结果","children":[]}]},{"level":2,"title":"灵医Bot Chat 接口分析","slug":"灵医bot-chat-接口分析","link":"#灵医bot-chat-接口分析","children":[{"level":3,"title":"Header参数","slug":"header参数","link":"#header参数","children":[]},{"level":3,"title":"非流式请求示例（单轮）参数","slug":"非流式请求示例-单轮-参数","link":"#非流式请求示例-单轮-参数","children":[]},{"level":3,"title":"非流式响应参数（单轮）","slug":"非流式响应参数-单轮","link":"#非流式响应参数-单轮","children":[]},{"level":3,"title":"非流式请求示例（多轮）","slug":"非流式请求示例-多轮","link":"#非流式请求示例-多轮","children":[]},{"level":3,"title":"非流式响应参数（多轮）","slug":"非流式响应参数-多轮","link":"#非流式响应参数-多轮","children":[]},{"level":3,"title":"请求示例（流式）","slug":"请求示例-流式","link":"#请求示例-流式","children":[]},{"level":3,"title":"响应示例（流式）","slug":"响应示例-流式","link":"#响应示例-流式","children":[]},{"level":3,"title":"请求示例 Java","slug":"请求示例-java","link":"#请求示例-java","children":[]},{"level":3,"title":"总结","slug":"总结","link":"#总结","children":[]}]},{"level":2,"title":"拟定义的统一接口契约","slug":"拟定义的统一接口契约","link":"#拟定义的统一接口契约","children":[{"level":3,"title":"入参（请求参数）","slug":"入参-请求参数","link":"#入参-请求参数","children":[]},{"level":3,"title":"返回参数 - 默认响应 (返回结果)","slug":"返回参数-默认响应-返回结果","link":"#返回参数-默认响应-返回结果","children":[]},{"level":3,"title":"返回参数 - 流式响应 (返回结果)","slug":"返回参数-流式响应-返回结果","link":"#返回参数-流式响应-返回结果","children":[]},{"level":3,"title":"extra 约定事项","slug":"extra-约定事项","link":"#extra-约定事项","children":[]},{"level":3,"title":"返回参数 - 流式响应 (返回结果)","slug":"返回参数-流式响应-返回结果-1","link":"#返回参数-流式响应-返回结果-1","children":[]}]},{"level":2,"title":"特别说明","slug":"特别说明","link":"#特别说明","children":[]}],"git":{"createdTime":1712632947000,"updatedTime":1712632947000,"contributors":[{"name":"lizhiquan","email":"lizhiquan@jianke.com","commits":1}]},"readingTime":{"minutes":13.01,"words":3902},"filePathRelative":"01.机器学习/01.大模型/20240305_LLM大模型统一封装接口解决方案.md","localizedDate":"2024年3月5日","excerpt":"<h2>目的：封装一个通用的 Java 框架的 chat completion 接口，来适配各种大模型的统一调用</h2>\\n<blockquote>\\n<p>限制条件：仅对聊天（文本）接口进行封装，其他接口待后续计划安排</p>\\n</blockquote>\\n<h2>OpenAi chat completion 接口分析</h2>\\n<blockquote>\\n<p><em>==&gt;<a href=\\"https://platform.openai.com/docs/api-reference/chat/create\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">官方文档</a></em></p>\\n</blockquote>"}`);export{T as comp,E as data};
