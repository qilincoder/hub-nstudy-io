import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as a,c as n,e}from"./app-r-0ZWJuU.js";const t={},o=e(`<h1 id="本文介绍-在linux环境下ssh映射端口" tabindex="-1"><a class="header-anchor" href="#本文介绍-在linux环境下ssh映射端口"><span>本文介绍，在Linux环境下ssh映射端口</span></a></h1><h2 id="操作环境说明" tabindex="-1"><a class="header-anchor" href="#操作环境说明"><span>操作环境说明</span></a></h2><h3 id="本地主机-客户机环境" tabindex="-1"><a class="header-anchor" href="#本地主机-客户机环境"><span>本地主机（客户机环境）</span></a></h3><blockquote><p>本地主机版本为 Ubuntu 22.04.2 LTS, 原则上只要有ssh命令即可。</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>root@ubuntu:~<span class="token comment"># lsb_release -a</span>

No LSB modules are available.
Distributor ID:	Ubuntu
Description:	Ubuntu <span class="token number">22.04</span>.2 LTS
Release:	<span class="token number">22.04</span>
Codename:	jammy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="远程主机-服务器环境" tabindex="-1"><a class="header-anchor" href="#远程主机-服务器环境"><span>远程主机（服务器环境）</span></a></h3><blockquote><p>远程主机版本为 Ubuntu 20.04 LTS , 原则上只要系统是Linux都通用且安装ssh即可。</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ubuntu@:~$ lsb_release <span class="token parameter variable">-a</span>

No LSB modules are available.
Distributor ID:	Ubuntu
Description:	Ubuntu <span class="token number">20.04</span> LTS
Release:	<span class="token number">20.04</span>
Codename:	focal
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="服务器之间互通说明-限制条件" tabindex="-1"><a class="header-anchor" href="#服务器之间互通说明-限制条件"><span>服务器之间互通说明（限制条件）</span></a></h3><blockquote><p>客户机只可以ssh访问服务器，服务器其他端口有网络策略加持无法访问，且可能由于服务器是生产环境，所以无法直接修改防火墙规则。</p></blockquote><blockquote><p>服务器与客户端方向网络不通，也即服务端无法ping通客户端IP地址。</p></blockquote><blockquote><p><span style="color:red;">一句话客户机只能ssh访问服务器，其他端口都不通。且服务器是公网IP，无法访问客户端服务。</span></p></blockquote><h2 id="背景介绍" tabindex="-1"><a class="header-anchor" href="#背景介绍"><span>背景介绍</span></a></h2><blockquote><p>由于网络策略限制，客户机只能ssh访问服务器，服务器上的web服务客户端无法直接访问，我们需要临时进行端口映射以达到客户端可以间接访问服务器服务。</p></blockquote><blockquote><p>另外客户端的服务，服务端也无法访问，可以利用ssh在服务器上访问客户端服务，以达到特殊的需求（比如，在服务器上通过访问客户端某服务拉取某些测试数据）。</p></blockquote><h2 id="客户端-服务器端ip-以及-服务说明" tabindex="-1"><a class="header-anchor" href="#客户端-服务器端ip-以及-服务说明"><span>客户端，服务器端IP 以及 服务说明</span></a></h2><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>客户机的IP地址为 <span class="token number">192.16</span>.xxx.xxx  有一个web服务，端口为 <span class="token number">8901</span>, 也即在客户端上 http://localhost:8901 是可以访问的

服务器的IP地址为 <span class="token number">172.17</span>.xxx.xxx  有一个web服务，端口为 <span class="token number">80</span>, 也即在服务器上  http://localhost  或 http://localhos:80 是可以访问的
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="要实现的目标" tabindex="-1"><a class="header-anchor" href="#要实现的目标"><span>要实现的目标</span></a></h2><h3 id="_1-在客户端上-通过ssh映射端口-实现客户端访问服务器服务。" tabindex="-1"><a class="header-anchor" href="#_1-在客户端上-通过ssh映射端口-实现客户端访问服务器服务。"><span><span style="color:red;">1.在客户端上，通过ssh映射端口，实现客户端访问服务器服务。</span></span></a></h3><h4 id="客户端终端执行下面命令" tabindex="-1"><a class="header-anchor" href="#客户端终端执行下面命令"><span>客户端终端执行下面命令</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># ssh -L 格式为 </span>
<span class="token comment"># ssh -L [本地主机:]本地主机端口:远程网络主机:远程网络主机端口</span>
<span class="token comment"># 客户机8088端口流量转发到服务器80端口</span>
<span class="token function">ssh</span> <span class="token parameter variable">-L</span> <span class="token number">8088</span>:localhost:80 root@172.17.xxx.xxx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="在另外一个客户端测试是否可以访问" tabindex="-1"><a class="header-anchor" href="#在另外一个客户端测试是否可以访问"><span>在另外一个客户端测试是否可以访问</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">curl</span> http://localhost:8088
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span><span class="token operator">&lt;</span>head<span class="token operator">&gt;</span><span class="token operator">&lt;</span>meta http-equiv<span class="token operator">=</span><span class="token string">&#39;refresh&#39;</span> <span class="token assign-left variable">content</span><span class="token operator">=</span><span class="token string">&#39;1;url=/login?from=%2F&#39;</span>/<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>window.location.replace<span class="token punctuation">(</span><span class="token string">&#39;/login?from=%2F&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span><span class="token operator">&lt;</span>body <span class="token assign-left variable">style</span><span class="token operator">=</span><span class="token string">&#39;background-color:white; color:white;&#39;</span><span class="token operator">&gt;</span>


Authentication required
<span class="token operator">&lt;</span><span class="token operator">!</span>--
--<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-在客户端上-通过ssh映射端口-实现在服务端可以访问客户端的服务。" tabindex="-1"><a class="header-anchor" href="#_2-在客户端上-通过ssh映射端口-实现在服务端可以访问客户端的服务。"><span><span style="color:red;">2.在客户端上，通过ssh映射端口，实现在服务端可以访问客户端的服务。</span></span></a></h3><h4 id="客户端终端执行下面命令-1" tabindex="-1"><a class="header-anchor" href="#客户端终端执行下面命令-1"><span>客户端终端执行下面命令</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># ssh -R 格式为 </span>
<span class="token comment"># ssh -R [登录主机:]登录主机端口:本地网络主机:本地网络主机端口</span>
<span class="token comment"># 将远程主机8088端口流量转发到本地主机端口8091</span>
<span class="token function">ssh</span> <span class="token parameter variable">-R</span> <span class="token number">8088</span>:localhost:8901 root@172.17.xxx.xxx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="在另外一个客户端测试是否可以访问-1" tabindex="-1"><a class="header-anchor" href="#在另外一个客户端测试是否可以访问-1"><span>在另外一个客户端测试是否可以访问</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">curl</span> http://localhost:8088

<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
    body <span class="token punctuation">{</span>
        width: 35em<span class="token punctuation">;</span>
        margin: <span class="token number">0</span> auto<span class="token punctuation">;</span>
        font-family: Tahoma, Verdana, Arial, sans-serif<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span>/style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.<span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>For online documentation and support please refer to
<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">&quot;http://nginx.org/&quot;</span><span class="token operator">&gt;</span>nginx.org<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>.<span class="token operator">&lt;</span>br/<span class="token operator">&gt;</span>
Commercial support is available at
<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">&quot;http://nginx.com/&quot;</span><span class="token operator">&gt;</span>nginx.com<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>.<span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token operator">&lt;</span>em<span class="token operator">&gt;</span>Thank you <span class="token keyword">for</span> using nginx.<span class="token operator">&lt;</span>/em<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-在客户端上-通过ssh动态端口转发-实现远程代理。" tabindex="-1"><a class="header-anchor" href="#_3-在客户端上-通过ssh动态端口转发-实现远程代理。"><span><span style="color:red;">3.在客户端上，通过ssh动态端口转发，实现远程代理。</span></span></a></h3><h4 id="客户端终端执行下面命令-2" tabindex="-1"><a class="header-anchor" href="#客户端终端执行下面命令-2"><span>客户端终端执行下面命令</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># ssh -D 格式为 </span>
<span class="token comment"># ssh -D [本地主机:]本地主机端口</span>
<span class="token comment"># 客户机8088端口流量转发到服务器网络</span>
<span class="token function">ssh</span> <span class="token parameter variable">-D</span> <span class="token number">8888</span> root@172.17.xxx.xxx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="在另外一个客户端测试是否可以访问-2" tabindex="-1"><a class="header-anchor" href="#在另外一个客户端测试是否可以访问-2"><span>在另外一个客户端测试是否可以访问</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">curl</span> --socks5-hostname <span class="token number">127.0</span>.0.1:8888 http://localhost

<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span><span class="token operator">&lt;</span>head<span class="token operator">&gt;</span><span class="token operator">&lt;</span>meta http-equiv<span class="token operator">=</span><span class="token string">&#39;refresh&#39;</span> <span class="token assign-left variable">content</span><span class="token operator">=</span><span class="token string">&#39;1;url=/login?from=%2F&#39;</span>/<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>window.location.replace<span class="token punctuation">(</span><span class="token string">&#39;/login?from=%2F&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span><span class="token operator">&lt;</span>body <span class="token assign-left variable">style</span><span class="token operator">=</span><span class="token string">&#39;background-color:white; color:white;&#39;</span><span class="token operator">&gt;</span>


Authentication required
<span class="token operator">&lt;</span><span class="token operator">!</span>--
--<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>

<span class="token comment">#或</span>

<span class="token function">curl</span> --socks5-hostname <span class="token number">127.0</span>.0.1:8888 https://www.baidu.com


<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>--STATUS OK--<span class="token operator">&gt;</span><span class="token operator">&lt;</span>html<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>head<span class="token operator">&gt;</span><span class="token operator">&lt;</span>meta http-equiv<span class="token operator">=</span>content-type <span class="token assign-left variable">content</span><span class="token operator">=</span>text/html<span class="token punctuation">;</span><span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span><span class="token operator">&lt;</span>meta http-equiv<span class="token operator">=</span>X-UA-Compatible <span class="token assign-left variable">content</span><span class="token operator">=</span>IE<span class="token operator">=</span>Edge<span class="token operator">&gt;</span><span class="token operator">&lt;</span>meta <span class="token assign-left variable">content</span><span class="token operator">=</span>always <span class="token assign-left variable">name</span><span class="token operator">=</span>referrer<span class="token operator">&gt;</span><span class="token operator">&lt;</span>link <span class="token assign-left variable">rel</span><span class="token operator">=</span>stylesheet <span class="token assign-left variable">type</span><span class="token operator">=</span>text/css <span class="token assign-left variable">href</span><span class="token operator">=</span>https://ss1.bdstatic.com/5eN1bjq8AAUYm2zgoY3K/r/www/cache/bdorz/baidu.min.css<span class="token operator">&gt;</span><span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>百度一下，你就知道<span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>body <span class="token assign-left variable">link</span><span class="token operator">=</span><span class="token comment">#0000cc&gt; &lt;div id=wrapper&gt; &lt;div id=head&gt; &lt;div class=head_wrapper&gt; &lt;div class=s_form&gt; &lt;div class=s_form_wrapper&gt; &lt;div id=lg&gt; &lt;img hidefocus=true src=//www.baidu.com/img/bd_logo1.png width=270 height=129&gt; &lt;/div&gt; &lt;form id=form name=f action=//www.baidu.com/s class=fm&gt; &lt;input type=hidden name=bdorz_come value=1&gt; &lt;input type=hidden name=ie value=utf-8&gt; &lt;input type=hidden name=f value=8&gt; &lt;input type=hidden name=rsv_bp value=1&gt; &lt;input type=hidden name=rsv_idx value=1&gt; &lt;input type=hidden name=tn value=baidu&gt;&lt;span class=&quot;bg s_ipt_wr&quot;&gt;&lt;input id=kw name=wd class=s_ipt value maxlength=255 autocomplete=off autofocus=autofocus&gt;&lt;/span&gt;&lt;span class=&quot;bg s_btn_wr&quot;&gt;&lt;input type=submit id=su value=百度一下 class=&quot;bg s_btn&quot; autofocus&gt;&lt;/span&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt; &lt;div id=u1&gt; &lt;a href=http://news.baidu.com name=tj_trnews class=mnav&gt;新闻&lt;/a&gt; &lt;a href=https://www.hao123.com name=tj_trhao123 class=mnav&gt;hao123&lt;/a&gt; &lt;a href=http://map.baidu.com name=tj_trmap class=mnav&gt;地图&lt;/a&gt; &lt;a href=http://v.baidu.com name=tj_trvideo class=mnav&gt;视频&lt;/a&gt; &lt;a href=http://tieba.baidu.com name=tj_trtieba class=mnav&gt;贴吧&lt;/a&gt; &lt;noscript&gt; &lt;a href=http://www.baidu.com/bdorz/login.gif?login&amp;amp;tpl=mn&amp;amp;u=http%3A%2F%2Fwww.baidu.com%2f%3fbdorz_come%3d1 name=tj_login class=lb&gt;登录&lt;/a&gt; &lt;/noscript&gt; &lt;script&gt;document.write(&#39;&lt;a href=&quot;http://www.baidu.com/bdorz/login.gif?login&amp;tpl=mn&amp;u=&#39;+ encodeURIComponent(window.location.href+ (window.location.search === &quot;&quot; ? &quot;?&quot; : &quot;&amp;&quot;)+ &quot;bdorz_come=1&quot;)+ &#39;&quot; name=&quot;tj_login&quot; class=&quot;lb&quot;&gt;登录&lt;/a&gt;&#39;);</span>
              <span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span>//www.baidu.com/more/ <span class="token assign-left variable">name</span><span class="token operator">=</span>tj_briicon <span class="token assign-left variable">class</span><span class="token operator">=</span>bri <span class="token assign-left variable">style</span><span class="token operator">=</span><span class="token string">&quot;display: block;&quot;</span><span class="token operator">&gt;</span>更多产品<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>div <span class="token assign-left variable">id</span><span class="token operator">=</span>ftCon<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>div <span class="token assign-left variable">id</span><span class="token operator">=</span>ftConw<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>p <span class="token assign-left variable">id</span><span class="token operator">=</span>lh<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span>http://home.baidu.com<span class="token operator">&gt;</span>关于百度<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span>http://ir.baidu.com<span class="token operator">&gt;</span>About Baidu<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>p <span class="token assign-left variable">id</span><span class="token operator">=</span>cp<span class="token operator">&gt;&amp;</span>copy<span class="token punctuation">;</span><span class="token number">2017</span><span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>Baidu<span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span><span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span>http://www.baidu.com/duty/<span class="token operator">&gt;</span>使用百度前必读<span class="token operator">&lt;</span>/a<span class="token operator">&gt;&amp;</span>nbsp<span class="token punctuation">;</span> <span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span>http://jianyi.baidu.com/ <span class="token assign-left variable">class</span><span class="token operator">=</span>cp-feedback<span class="token operator">&gt;</span>意见反馈<span class="token operator">&lt;</span>/a<span class="token operator">&gt;&amp;</span>nbsp<span class="token punctuation">;</span>京ICP证030173号<span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span> <span class="token operator">&lt;</span>img <span class="token assign-left variable">src</span><span class="token operator">=</span>//www.baidu.com/img/gs.gif<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ssh切换后台执行" tabindex="-1"><a class="header-anchor" href="#ssh切换后台执行"><span>ssh切换后台执行</span></a></h2><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">ssh</span> <span class="token parameter variable">-R</span> <span class="token number">8088</span>:localhost:8901 root@172.17.xxx.xxx
<span class="token comment"># 上面命令是前端执行，可以用户 -N -f 命令切换为后端进程，如下</span>
<span class="token function">ssh</span> <span class="token parameter variable">-N</span> <span class="token parameter variable">-f</span> <span class="token parameter variable">-R</span> <span class="token number">8088</span>:localhost:8901 root@172.17.xxx.xxx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="部分参数解释" tabindex="-1"><a class="header-anchor" href="#部分参数解释"><span>部分参数解释</span></a></h2><blockquote><p>要查看ssh命令的参数，可以使用 man ssh 命令</p></blockquote><ul><li><span style="color:red;">-f</span></li></ul><blockquote><p>Requests ssh to go to background just before command execution. This is useful if ssh is going to ask for passwords or passphrases, but the user wants it in the background. This implies -n. The recommended way to start X11 programs at a remote site is with something like ssh -f host xterm.<br><span style="color:red;">一句话转到后台执行命令</span></p></blockquote><ul><li><span style="color:red;">-L [bind_address:]port:host:hostport<br> -L [bind_address:]port:remote_socket<br> -L local_socket:host:hostport<br> -L local_socket:remote_socket</span></li></ul><blockquote><p>Specifies that connections to the given TCP port or Unix socket on the local (client) host are to be forwarded to the given host and port, or Unix socket, on the remote side. This works by allocating a socket to listen to either a TCP port on the local side, optionally bound to the specified bind_address, or to a Unix socket. Whenever a connection is made to the local port or socket, the connection is forwarded over the secure channel, and a connection is made to either host port hostport, or the Unix socket remote_socket, from the remote machine.</p></blockquote><blockquote><p>Port forwardings can also be specified in the configuration file. Only the superuser can forward privileged ports. IPv6 addresses can be specified by enclosing the address in square brackets.</p></blockquote><blockquote><p>By default, the local port is bound in accordance with the GatewayPorts setting. However, an explicit bind_address may be used to bind the connection to a specific address. The bind_address of “localhost” indi‐cates that the listening port be bound for local use only, while an empty address or ‘*’ indicates that the port should be available from all interfaces<br><span style="color:red;">翻译</span></p></blockquote><blockquote><p>指定本地（客户端）主机上连接到给定 TCP 端口或 Unix 套接字的连接将被转发到远程主机上给定的主机和端口，或 Unix 套接字。这通过分配一个套接字来实现，以监听本地端口或套接字上的连接，可选地绑定到指定的 bind_address，或者绑定到 Unix 套接字。每当连接建立到本地端口或套接字时，连接将通过安全通道转发，并且将在远程机器上建立到主机端口 hostport 或 Unix 套接字 remote_socket 的连接。</p></blockquote><blockquote><p>端口转发也可以在配置文件中指定。只有超级用户可以转发特权端口。IPv6 地址可以通过将地址括在方括号中来指定。</p></blockquote><blockquote><p>默认情况下，本地端口根据 GatewayPorts 设置绑定。然而，可以使用显式的 bind_address 将连接绑定到特定地址。绑定到“localhost”的 bind_address 表示监听端口仅供本地使用，而空地址或 &#39;*&#39; 表示该端口应该从所有接口可用。</p></blockquote><ul><li><span style="color:red;">-R [bind_address:]port:host:hostport<br> -R [bind_address:]port:local_socket<br> -R remote_socket:host:hostport<br> -R remote_socket:local_socket<br> -R [bind_address:]port</span></li></ul><blockquote><p>Specifies that connections to the given TCP port or Unix socket on the remote (server) host are to be forwarded to the local side.</p></blockquote><blockquote><p>This works by allocating a socket to listen to either a TCP port or to a Unix socket on the remote side. Whenever a connection is made to this port or Unix socket, the connection is forwarded over the secure channel, and a connection is made from the local machine to either an explicit destination specified by host port hostport, or local_socket, or, if no explicit destination was specified, ssh will act as a SOCKS 4/5 proxy and forward connections to the destinations requested by the remote SOCKS client.</p></blockquote><blockquote><p>Port forwardings can also be specified in the configuration file. Privileged ports can be forwarded only when logging in as root on the remote machine. IPv6 addresses can be specified by enclosing the address in square brackets.</p></blockquote><blockquote><p>By default, TCP listening sockets on the server will be bound to the loopback interface only. This may be overridden by specifying a bind_address. An empty bind_address, or the address ‘*’, indicates that the remote socket should listen on all interfaces. Specifying a remote bind_address will only succeed if the server&#39;s GatewayPorts option is enabled (see sshd_config(5)).</p></blockquote><blockquote><p>If the port argument is ‘0’, the listen port will be dynamically allocated on the server and reported to the client at run time. When used together with -O forward the allocated port will be printed to the stan‐dard output.</p></blockquote><blockquote><p><span style="color:red;">翻译</span></p></blockquote><blockquote><p>指定将连接到远程（服务器）主机上给定的 TCP 端口或 Unix 套接字的连接转发到本地侧。</p></blockquote><blockquote><p>这通过分配一个套接字来实现，以监听远程侧的 TCP 端口或 Unix 套接字。每当建立到该端口或 Unix 套接字的连接时，连接将通过安全通道转发，并且从本地机器到明确由主机端口 hostport 或 local_socket 指定的目标，或者，如果没有明确指定目标，ssh 将充当 SOCKS 4/5 代理并将连接转发到远程 SOCKS 客户端请求的目标。</p></blockquote><blockquote><p>端口转发也可以在配置文件中指定。只有在远程主机上以 root 身份登录时才能转发特权端口。IPv6 地址可以通过将地址括在方括号中来指定。</p></blockquote><blockquote><p>默认情况下，服务器上的 TCP 监听套接字将仅绑定到环回接口。这可以通过指定 bind_address 来覆盖。一个空的 bind_address，或地址 ‘*’，表示远程套接字应该在所有接口上监听。只有在服务器的 GatewayPorts 选项启用时，指定远程 bind_address 才会成功（参见 sshd_config(5)）。</p></blockquote><blockquote><p>如果端口参数是 ‘0’，则监听端口将在运行时在服务器上动态分配，并将在客户端报告。当与 -O forward 一起使用时，分配的端口将打印到标准输出。</p></blockquote><ul><li><span style="color:red;"> -D [bind_address:]port</span></li></ul><blockquote><p>Specifies a local “dynamic” application-level port forwarding. This works by allocating a socket to listen to port on the local side, optionally bound to the specified bind_address. Whenever a connection is made to this port, the connection is forwarded over the secure channel, and the application protocol is then used to determine where to connect to from the remote machine. Currently the SOCKS4 and SOCKS5 protocols are supported, and ssh will act as a SOCKS server. Only root can forward privileged ports. Dynamic port forwardings can also be specified in the configuration file.</p></blockquote><blockquote><p>IPv6 addresses can be specified by enclosing the address in square brackets. Only the superuser can forward privileged ports. By default, the local port is bound in accordance with the GatewayPorts setting.</p></blockquote><blockquote><p>However, an explicit bind_address may be used to bind the connection to a specific address. The bind_address of “localhost” indicates that the listening port be bound for local use only, while an empty address or ‘*’ indicates that the port should be available from all interfaces.</p></blockquote><blockquote><p><span style="color:red;">翻译</span></p></blockquote><blockquote><p>指定本地的“动态”应用级端口转发。这通过分配一个套接字来实现，在本地一侧监听端口，可选地绑定到指定的 bind_address。每当建立到该端口的连接时，连接将通过安全通道转发，并且应用程序协议将用于确定从远程机器连接到何处。目前支持 SOCKS4 和 SOCKS5 协议，ssh 将充当 SOCKS 服务器。只有超级用户才能转发特权端口。动态端口转发也可以在配置文件中指定。</p></blockquote><blockquote><p>IPv6 地址可以通过将地址括在方括号中来指定。只有超级用户才能转发特权端口。默认情况下，本地端口根据 GatewayPorts 设置绑定。</p></blockquote><blockquote><p>然而，可以使用显式的 bind_address 将连接绑定到特定地址。绑定到“localhost”的 bind_address 表示监听端口仅供本地使用，而空地址或 &#39;*&#39; 表示该端口应该从所有接口可用。</p></blockquote><ul><li><span style="color:red;"> -N</span></li></ul><blockquote><p>Do not execute a remote command. This is useful for just forwarding ports. Refer to the description of SessionType in ssh_config(5) for details</p></blockquote><blockquote><p><span style="color:red;">一句话就是创建连接后不执行任何命令</span></p></blockquote><h2 id="其他情况说明" tabindex="-1"><a class="header-anchor" href="#其他情况说明"><span>其他情况说明</span></a></h2><blockquote><p>如果遇到超时问题，可以尝试在ssh命令中添加 -o ServerAliveInterval=60 -o ServerAliveCountMax=60 选项。</p></blockquote><blockquote><p>或者修改配置文件</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/ssh/ssh_config

ServerAliveInterval  <span class="token number">60</span>
ServerAliveCountMax  <span class="token number">60</span>

<span class="token comment"># 重启ssh服务使配置生效</span>
systemctl restart sshd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,73),l=[o];function p(r,i){return a(),n("div",null,l)}const u=s(t,[["render",p],["__file","af6982.html.vue"]]),h=JSON.parse(`{"path":"/p2024/Linux/others/af6982.html","title":"ssh映射端口","lang":"zh-CN","frontmatter":{"permalink":"/p2024/Linux/others/af6982.html","lang":"zh-CN","title":"ssh映射端口","description":"ssh免密登录","isOriginal":true,"date":"2024-02-29T00:00:00.000Z","category":["Linux"],"tag":["Linux","ssh","ssh映射端口"],"head":[["meta",{"name":"keywords","content":"Linux,ssh,ssh映射端口"}],["meta",{"property":"og:url","content":"https://hub.nstudy.org/p2024/Linux/others/af6982.html"}],["meta",{"property":"og:site_name","content":"Jack's 新学习基地"}],["meta",{"property":"og:title","content":"ssh映射端口"}],["meta",{"property":"og:description","content":"ssh免密登录"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-12T10:30:28.000Z"}],["meta",{"property":"article:author","content":"Jack"}],["meta",{"property":"article:tag","content":"Linux"}],["meta",{"property":"article:tag","content":"ssh"}],["meta",{"property":"article:tag","content":"ssh映射端口"}],["meta",{"property":"article:published_time","content":"2024-02-29T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-04-12T10:30:28.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"ssh映射端口\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-02-29T00:00:00.000Z\\",\\"dateModified\\":\\"2024-04-12T10:30:28.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Jack\\",\\"url\\":\\"https://hub.nstudy.org\\"}]}"]],"star":true,"sticky":true},"headers":[{"level":2,"title":"操作环境说明","slug":"操作环境说明","link":"#操作环境说明","children":[{"level":3,"title":"本地主机（客户机环境）","slug":"本地主机-客户机环境","link":"#本地主机-客户机环境","children":[]},{"level":3,"title":"远程主机（服务器环境）","slug":"远程主机-服务器环境","link":"#远程主机-服务器环境","children":[]},{"level":3,"title":"服务器之间互通说明（限制条件）","slug":"服务器之间互通说明-限制条件","link":"#服务器之间互通说明-限制条件","children":[]}]},{"level":2,"title":"背景介绍","slug":"背景介绍","link":"#背景介绍","children":[]},{"level":2,"title":"客户端，服务器端IP 以及 服务说明","slug":"客户端-服务器端ip-以及-服务说明","link":"#客户端-服务器端ip-以及-服务说明","children":[]},{"level":2,"title":"要实现的目标","slug":"要实现的目标","link":"#要实现的目标","children":[{"level":3,"title":"1.在客户端上，通过ssh映射端口，实现客户端访问服务器服务。","slug":"_1-在客户端上-通过ssh映射端口-实现客户端访问服务器服务。","link":"#_1-在客户端上-通过ssh映射端口-实现客户端访问服务器服务。","children":[]},{"level":3,"title":"2.在客户端上，通过ssh映射端口，实现在服务端可以访问客户端的服务。","slug":"_2-在客户端上-通过ssh映射端口-实现在服务端可以访问客户端的服务。","link":"#_2-在客户端上-通过ssh映射端口-实现在服务端可以访问客户端的服务。","children":[]},{"level":3,"title":"3.在客户端上，通过ssh动态端口转发，实现远程代理。","slug":"_3-在客户端上-通过ssh动态端口转发-实现远程代理。","link":"#_3-在客户端上-通过ssh动态端口转发-实现远程代理。","children":[]}]},{"level":2,"title":"ssh切换后台执行","slug":"ssh切换后台执行","link":"#ssh切换后台执行","children":[]},{"level":2,"title":"部分参数解释","slug":"部分参数解释","link":"#部分参数解释","children":[]},{"level":2,"title":"其他情况说明","slug":"其他情况说明","link":"#其他情况说明","children":[]}],"git":{"createdTime":1712917828000,"updatedTime":1712917828000,"contributors":[{"name":"lizhiquan","email":"lizhiquan@jianke.com","commits":1}]},"readingTime":{"minutes":10.75,"words":3226},"filePathRelative":"06.Linux/99.others/20240229_ssh映射端口.md","localizedDate":"2024年2月29日","excerpt":"\\n<h2>操作环境说明</h2>\\n<h3>本地主机（客户机环境）</h3>\\n<blockquote>\\n<p>本地主机版本为 Ubuntu 22.04.2 LTS, 原则上只要有ssh命令即可。</p>\\n</blockquote>\\n<div class=\\"language-bash\\" data-ext=\\"sh\\" data-title=\\"sh\\"><pre class=\\"language-bash\\"><code>root@ubuntu:~<span class=\\"token comment\\"># lsb_release -a</span>\\n\\nNo LSB modules are available.\\nDistributor ID:\\tUbuntu\\nDescription:\\tUbuntu <span class=\\"token number\\">22.04</span>.2 LTS\\nRelease:\\t<span class=\\"token number\\">22.04</span>\\nCodename:\\tjammy\\n</code></pre></div>"}`);export{u as comp,h as data};
